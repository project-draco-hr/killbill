{
  loadSystemPropertiesFromClasspath("/resource.properties");
  final MysqlTestingHelper helper=KillbillTestSuiteWithEmbeddedDB.getMysqlTestingHelper();
  final IDBI dbi=helper.getDBI();
  invoiceSqlDao=dbi.onDemand(InvoiceSqlDao.class);
  invoiceSqlDao.test(internalCallContext);
  invoiceItemSqlDao=dbi.onDemand(InvoiceItemSqlDao.class);
  invoiceItemSqlDao.test(internalCallContext);
  final NextBillingDatePoster nextBillingDatePoster=new MockNextBillingDatePoster();
  final TagDefinitionDao tagDefinitionDao=new MockTagDefinitionDao();
  final TagDao tagDao=new MockTagDao();
  internalCallContextFactory=new InternalCallContextFactory(dbi,clock);
  final TagUserApi tagUserApi=new DefaultTagUserApi(internalCallContextFactory,tagDefinitionDao,tagDao);
  final InvoiceDao invoiceDao=new AuditedInvoiceDao(dbi,nextBillingDatePoster,tagUserApi,clock,Mockito.mock(Bus.class));
  invoicePaymentApi=new DefaultInvoicePaymentApi(invoiceDao,internalCallContextFactory);
}
