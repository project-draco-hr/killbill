{
  loadSystemPropertiesFromClasspath("/resource.properties");
  final MysqlTestingHelper helper=KillbillTestSuiteWithEmbeddedDB.getMysqlTestingHelper();
  final IDBI dbi=helper.getDBI();
  invoiceSqlDao=dbi.onDemand(InvoiceSqlDao.class);
  invoiceSqlDao.test(internalCallContext);
  invoiceItemSqlDao=dbi.onDemand(InvoiceItemSqlDao.class);
  invoiceItemSqlDao.test(internalCallContext);
  final NextBillingDatePoster nextBillingDatePoster=new MockNextBillingDatePoster();
  internalCallContextFactory=new InternalCallContextFactory(dbi,clock);
  final InvoiceDao invoiceDao=new DefaultInvoiceDao(dbi,nextBillingDatePoster,Mockito.mock(InternalBus.class));
  invoicePaymentApi=new DefaultInvoicePaymentApi(invoiceDao,internalCallContextFactory);
  invoiceApi=new DefaultInvoiceInternalApi(invoiceDao);
}
