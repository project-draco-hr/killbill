{
  loadSystemPropertiesFromClasspath("/resource.properties");
  final MysqlTestingHelper helper=new MysqlTestingHelper();
  final IDBI dbi=helper.getDBI();
  final String invoiceDdl=IOUtils.toString(DefaultInvoiceDao.class.getResourceAsStream("/com/ning/billing/invoice/ddl.sql"));
  final String utilDdl=IOUtils.toString(DefaultInvoiceDao.class.getResourceAsStream("/com/ning/billing/util/ddl.sql"));
  helper.startMysql();
  helper.initDb(invoiceDdl);
  helper.initDb(utilDdl);
  invoiceSqlDao=dbi.onDemand(InvoiceSqlDao.class);
  invoiceSqlDao.test();
  final NextBillingDatePoster nextBillingDatePoster=new MockNextBillingDatePoster();
  final TagDefinitionDao tagDefinitionDao=new MockTagDefinitionDao();
  final TagDao tagDao=new MockTagDao();
  final TagUserApi tagUserApi=new DefaultTagUserApi(tagDefinitionDao,tagDao);
  final InvoiceDao invoiceDao=new DefaultInvoiceDao(dbi,nextBillingDatePoster,tagUserApi);
  invoicePaymentApi=new DefaultInvoicePaymentApi(invoiceDao);
  context=new TestCallContext("Charge back tests");
}
