{
  try {
    nextBillingQueue=notificationQueueService.createNotificationQueue(DefaultInvoiceService.INVOICE_SERVICE_NAME,NEXT_BILLING_DATE_NOTIFIER_QUEUE,new NotificationQueueHandler(){
      @Override public void handleReadyNotification(      String notificationKey,      DateTime eventDate){
        try {
          UUID key=UUID.fromString(notificationKey);
          Subscription subscription=entitlementUserApi.getSubscriptionFromId(key);
          if (subscription == null) {
            log.warn("Next Billing Date Notification Queue handled spurious notification (key: " + key + ")");
          }
 else {
            processEvent(key,eventDate);
          }
        }
 catch (        IllegalArgumentException e) {
          log.error("The key returned from the NextBillingNotificationQueue is not a valid UUID",e);
          return;
        }
      }
    }
,new NotificationConfig(){
      @Override public boolean isNotificationProcessingOff(){
        return config.isEventProcessingOff();
      }
      @Override public long getNotificationSleepTimeMs(){
        return config.getNotificationSleepTimeMs();
      }
      @Override public int getDaoMaxReadyEvents(){
        return config.getDaoMaxReadyEvents();
      }
      @Override public long getDaoClaimTimeMs(){
        return config.getDaoClaimTimeMs();
      }
    }
);
  }
 catch (  NotificationQueueAlreadyExists e) {
    throw new RuntimeException(e);
  }
}
