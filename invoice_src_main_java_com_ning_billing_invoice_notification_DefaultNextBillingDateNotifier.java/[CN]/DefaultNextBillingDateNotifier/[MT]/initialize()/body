{
  nextBillingQueue=notificationQueueService.createNotificationQueue(DefaultInvoiceService.INVOICE_SERVICE_NAME,NEXT_BILLING_DATE_NOTIFIER_QUEUE,new NotificationQueueHandler(){
    @Override public void handleReadyNotification(    String notificationKey,    DateTime eventDate){
      try {
        UUID key=UUID.fromString(notificationKey);
        try {
          Subscription subscription=entitlementUserApi.getSubscriptionFromId(key);
          if (subscription == null) {
            log.warn("Next Billing Date Notification Queue handled spurious notification (key: " + key + ")");
          }
 else {
            processEvent(key,eventDate);
          }
        }
 catch (        EntitlementUserApiException e) {
          log.warn("Next Billing Date Notification Queue handled spurious notification (key: " + key + ")",e);
        }
      }
 catch (      IllegalArgumentException e) {
        log.error("The key returned from the NextBillingNotificationQueue is not a valid UUID",e);
        return;
      }
    }
  }
,new NotificationConfig(){
    @Override public long getSleepTimeMs(){
      return config.getSleepTimeMs();
    }
    @Override public boolean isNotificationProcessingOff(){
      return config.isNotificationProcessingOff();
    }
  }
);
}
