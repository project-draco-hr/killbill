{
  final InternalCallContext context=internalCallContextFactory.createInternalCallContext(callContext);
  try {
    final Subscription baseSubscription=subscriptionInternalApi.getSubscriptionFromId(baseSubscriptionId,context);
    if (baseSubscription.getCategory() != ProductCategory.BASE || baseSubscription.getState() != SubscriptionState.ACTIVE) {
      throw new EntitlementApiException(new SubscriptionUserApiException(ErrorCode.SUB_GET_NO_SUCH_BASE_SUBSCRIPTION,baseSubscription.getBundleId()));
    }
    final Subscription subscription=subscriptionInternalApi.createSubscription(baseSubscription.getBundleId(),planPhaseSpecifier,clock.getUTCNow(),context);
    return new DefaultEntitlement(accountApi,subscription,internalCallContextFactory,clock,checker);
  }
 catch (  SubscriptionUserApiException e) {
    throw new EntitlementApiException(e);
  }
}
