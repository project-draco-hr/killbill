{
  final InternalTenantContext context=internalCallContextFactory.createInternalTenantContext(accountId,tenantContext);
  try {
    final List<SubscriptionBaseBundle> bundles=subscriptionInternalApi.getBundlesForAccountAndKey(accountId,externalKey,context);
    if (bundles.size() == 0) {
      return Collections.emptyList();
    }
    final Account account=accountApi.getAccountById(bundles.get(0).getAccountId(),context);
    return getEntitlementsForBundles(bundles,account,context);
  }
 catch (  SubscriptionBaseApiException e) {
    throw new EntitlementApiException(e);
  }
catch (  AccountApiException e) {
    throw new EntitlementApiException(e);
  }
}
