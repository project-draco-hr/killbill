{
  final InternalCallContext contextWithValidAccountRecordId=internalCallContextFactory.createInternalCallContext(bundleId,ObjectType.BUNDLE,context);
  final BlockingState currentState=blockingStateDao.getBlockingStateForService(bundleId,EntitlementService.ENTITLEMENT_SERVICE_NAME,contextWithValidAccountRecordId);
  if (currentState != null && currentState.getStateName().equals(ENT_STATE_BLOCKED)) {
    throw new EntitlementApiException(ErrorCode.ENT_ALREADY_BLOCKED,bundleId);
  }
  blockingStateDao.setBlockingState(new DefaultBlockingState(bundleId,BlockingStateType.BUNDLE,ENT_STATE_BLOCKED,EntitlementService.ENTITLEMENT_SERVICE_NAME,true,true,true,clock.getUTCNow()),clock,contextWithValidAccountRecordId);
}
