{
  LocalDate result=null;
  final BlockingState subEntitlementState=blockingStateDao.getBlockingStateForService(subscriptionBase.getId(),EntitlementService.ENTITLEMENT_SERVICE_NAME,context);
  if (subEntitlementState != null && subEntitlementState.getStateName().equals(ENT_STATE_CANCELLED)) {
    result=new LocalDate(subEntitlementState.getEffectiveDate(),accountTimeZone);
  }
  final BlockingState bundleEntitlementState=blockingStateDao.getBlockingStateForService(subscriptionBase.getBundleId(),EntitlementService.ENTITLEMENT_SERVICE_NAME,context);
  if (bundleEntitlementState != null && bundleEntitlementState.getStateName().equals(ENT_STATE_CANCELLED)) {
    final LocalDate localDate=new LocalDate(bundleEntitlementState.getEffectiveDate(),accountTimeZone);
    result=result == null || result.compareTo(localDate) < 0 ? localDate : result;
  }
  final BlockingState accountEntitlementState=blockingStateDao.getBlockingStateForService(accountId,EntitlementService.ENTITLEMENT_SERVICE_NAME,context);
  if (accountEntitlementState != null && accountEntitlementState.getStateName().equals(ENT_STATE_CANCELLED)) {
    final LocalDate localDate=new LocalDate(accountEntitlementState.getEffectiveDate(),accountTimeZone);
    result=result == null || result.compareTo(localDate) < 0 ? localDate : result;
  }
  return result;
}
