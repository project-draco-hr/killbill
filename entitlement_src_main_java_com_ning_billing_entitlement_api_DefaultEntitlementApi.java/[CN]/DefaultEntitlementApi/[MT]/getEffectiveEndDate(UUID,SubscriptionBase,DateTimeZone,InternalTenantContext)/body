{
  LocalDate result=null;
  final BlockingState subEntitlementState=blockingStateDao.getBlockingStateForService(subscriptionBase.getId(),EntitlementService.ENTITLEMENT_SERVICE_NAME,context);
  if (subEntitlementState != null && ENT_STATE_CANCELLED.equals(subEntitlementState.getStateName())) {
    result=new LocalDate(subEntitlementState.getEffectiveDate(),accountTimeZone);
  }
  final BlockingState bundleEntitlementState=blockingStateDao.getBlockingStateForService(subscriptionBase.getBundleId(),EntitlementService.ENTITLEMENT_SERVICE_NAME,context);
  if (bundleEntitlementState != null && ENT_STATE_CANCELLED.equals(bundleEntitlementState.getStateName())) {
    final LocalDate localDate=new LocalDate(bundleEntitlementState.getEffectiveDate(),accountTimeZone);
    result=(result == null) || (result.compareTo(localDate) < 0) ? result : localDate;
  }
  final BlockingState accountEntitlementState=blockingStateDao.getBlockingStateForService(accountId,EntitlementService.ENTITLEMENT_SERVICE_NAME,context);
  if (accountEntitlementState != null && ENT_STATE_CANCELLED.equals(accountEntitlementState.getStateName())) {
    final LocalDate localDate=new LocalDate(accountEntitlementState.getEffectiveDate(),accountTimeZone);
    result=(result == null) || (result.compareTo(localDate) < 0) ? result : localDate;
  }
  return result;
}
