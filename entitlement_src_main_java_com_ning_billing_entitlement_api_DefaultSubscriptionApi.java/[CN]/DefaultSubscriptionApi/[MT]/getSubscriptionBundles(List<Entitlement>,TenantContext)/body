{
  final ListMultimap<UUID,Entitlement> perBundleEntitlements=LinkedListMultimap.create();
  for (  Entitlement cur : entitlements) {
    perBundleEntitlements.put(cur.getBundleId(),cur);
  }
  final List<SubscriptionBundle> result=new ArrayList<SubscriptionBundle>(perBundleEntitlements.keySet().size());
  for (  UUID bundleId : perBundleEntitlements.keySet()) {
    final List<Entitlement> allEntitlementsForBundle=perBundleEntitlements.get(bundleId);
    final SubscriptionBundle bundle=getSubscriptionBundleFromEntitlements(bundleId,allEntitlementsForBundle,context);
    result.add(bundle);
  }
  return result;
}
