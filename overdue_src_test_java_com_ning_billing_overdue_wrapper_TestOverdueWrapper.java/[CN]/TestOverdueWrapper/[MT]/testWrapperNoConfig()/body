{
  overdueWrapperFactory.setOverdueConfig(null);
  SubscriptionBundle bundle;
  OverdueWrapper<SubscriptionBundle> wrapper;
  OverdueState<SubscriptionBundle> state;
  InputStream is=new ByteArrayInputStream(configXml.getBytes());
  config=XMLLoader.getObjectFromStreamNoValidation(is,OverdueConfig.class);
  state=config.getBundleStateSet().findState(BlockingApi.CLEAR_STATE_NAME);
  bundle=createBundle(clock.getUTCNow().minusDays(31));
  wrapper=overdueWrapperFactory.createOverdueWrapperFor(bundle);
  OverdueState<SubscriptionBundle> result=wrapper.refresh();
  Assert.assertEquals(result.getName(),state.getName());
  Assert.assertEquals(result.blockChanges(),state.blockChanges());
  Assert.assertEquals(result.disableEntitlementAndChangesBlocked(),state.disableEntitlementAndChangesBlocked());
}
