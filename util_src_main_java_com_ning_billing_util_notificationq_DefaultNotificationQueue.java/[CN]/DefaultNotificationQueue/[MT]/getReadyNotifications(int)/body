{
  final Date now=clock.getUTCNow().toDate();
  final Date nextAvailable=clock.getUTCNow().plus(config.getDaoClaimTimeMs()).toDate();
  List<Notification> input=dao.getReadyNotifications(now,config.getDaoMaxReadyEvents(),getFullQName());
  List<Notification> claimedNotifications=new ArrayList<Notification>();
  for (  Notification cur : input) {
    logDebug("about to claim notification %s,  key = %s for time %s",cur.getUUID(),cur.getNotificationKey(),cur.getEffectiveDate());
    final boolean claimed=(dao.claimNotification(hostname,nextAvailable,cur.getId(),now) == 1);
    logDebug("claimed notification %s, key = %s for time %s result = %s",cur.getUUID(),cur.getNotificationKey(),cur.getEffectiveDate(),Boolean.valueOf(claimed));
    if (claimed) {
      claimedNotifications.add(cur);
      dao.insertClaimedHistory(seqId,hostname,now,cur.getUUID().toString());
    }
  }
  for (  Notification cur : claimedNotifications) {
    if (cur.getOwner() != null && !cur.getOwner().equals(hostname)) {
      log.warn(String.format("NotificationQueue %s stealing notification %s from %s",getFullQName(),cur,cur.getOwner()));
    }
  }
  return claimedNotifications;
}
