{
  UUID accountId=UUID.randomUUID();
  DateTime targetDate1=new DateTime(2011,10,6,0,0,0,0);
  Invoice invoice1=new DefaultInvoice(accountId,targetDate1,Currency.USD,clock);
  invoiceDao.create(invoice1);
  DateTime startDate=new DateTime(2011,3,1,0,0,0,0);
  DateTime endDate=startDate.plusMonths(1);
  BigDecimal rate1=new BigDecimal("17.0");
  BigDecimal rate2=new BigDecimal("42.0");
  RecurringInvoiceItem item1=new RecurringInvoiceItem(invoice1.getId(),UUID.randomUUID(),"test plan","test phase A",startDate,endDate,rate1,rate1,Currency.USD,clock.getUTCNow(),clock.getUTCNow());
  recurringInvoiceItemDao.create(item1);
  RecurringInvoiceItem item2=new RecurringInvoiceItem(invoice1.getId(),UUID.randomUUID(),"test plan","test phase B",startDate,endDate,rate2,rate2,Currency.USD,clock.getUTCNow(),clock.getUTCNow());
  recurringInvoiceItemDao.create(item2);
  BigDecimal balance=invoiceDao.getAccountBalance(accountId);
  assertEquals(balance.compareTo(rate1.add(rate2)),0);
}
