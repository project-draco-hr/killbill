{
  UUID accountId=UUID.randomUUID();
  UUID subscriptionId1=UUID.randomUUID();
  BigDecimal rate1=new BigDecimal("17.0");
  UUID subscriptionId2=UUID.randomUUID();
  BigDecimal rate2=new BigDecimal("42.0");
  UUID subscriptionId3=UUID.randomUUID();
  BigDecimal rate3=new BigDecimal("3.0");
  UUID subscriptionId4=UUID.randomUUID();
  BigDecimal rate4=new BigDecimal("12.0");
  DateTime targetDate=new DateTime(2011,5,23,0,0,0,0);
  Invoice invoice1=new DefaultInvoice(accountId,targetDate,Currency.USD);
  invoiceDao.create(invoice1);
  UUID invoiceId1=invoice1.getId();
  DateTime startDate=new DateTime(2011,3,1,0,0,0,0);
  DateTime endDate=startDate.plusMonths(1);
  DefaultInvoiceItem item1=new DefaultInvoiceItem(invoiceId1,subscriptionId1,startDate,endDate,"test A",rate1,rate1,Currency.USD);
  invoiceItemDao.create(item1);
  DefaultInvoiceItem item2=new DefaultInvoiceItem(invoiceId1,subscriptionId2,startDate,endDate,"test B",rate2,rate2,Currency.USD);
  invoiceItemDao.create(item2);
  DefaultInvoiceItem item3=new DefaultInvoiceItem(invoiceId1,subscriptionId3,startDate,endDate,"test C",rate3,rate3,Currency.USD);
  invoiceItemDao.create(item3);
  DefaultInvoiceItem item4=new DefaultInvoiceItem(invoiceId1,subscriptionId4,startDate,endDate,"test D",rate4,rate4,Currency.USD);
  invoiceItemDao.create(item4);
  DefaultInvoice invoice2=new DefaultInvoice(accountId,targetDate,Currency.USD);
  invoiceDao.create(invoice2);
  UUID invoiceId2=invoice2.getId();
  startDate=endDate;
  endDate=startDate.plusMonths(1);
  DefaultInvoiceItem item5=new DefaultInvoiceItem(invoiceId2,subscriptionId1,startDate,endDate,"test A",rate1,rate1,Currency.USD);
  invoiceItemDao.create(item5);
  DefaultInvoiceItem item6=new DefaultInvoiceItem(invoiceId2,subscriptionId2,startDate,endDate,"test B",rate2,rate2,Currency.USD);
  invoiceItemDao.create(item6);
  DefaultInvoiceItem item7=new DefaultInvoiceItem(invoiceId2,subscriptionId3,startDate,endDate,"test C",rate3,rate3,Currency.USD);
  invoiceItemDao.create(item7);
  List<Invoice> items1=invoiceDao.getInvoicesBySubscription(subscriptionId1);
  assertEquals(items1.size(),2);
  List<Invoice> items2=invoiceDao.getInvoicesBySubscription(subscriptionId2);
  assertEquals(items2.size(),2);
  List<Invoice> items3=invoiceDao.getInvoicesBySubscription(subscriptionId3);
  assertEquals(items3.size(),2);
  List<Invoice> items4=invoiceDao.getInvoicesBySubscription(subscriptionId4);
  assertEquals(items4.size(),1);
}
