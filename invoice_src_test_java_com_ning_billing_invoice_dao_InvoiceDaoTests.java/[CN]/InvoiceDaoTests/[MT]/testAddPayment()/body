{
  UUID accountId=UUID.randomUUID();
  DateTime targetDate=new DateTime(2011,10,6,0,0,0,0);
  Invoice invoice=new DefaultInvoice(accountId,targetDate,Currency.USD);
  UUID paymentAttemptId=UUID.randomUUID();
  DateTime paymentAttemptDate=new DateTime(2011,6,24,12,14,36,0);
  BigDecimal paymentAmount=new BigDecimal("14.0");
  invoiceDao.create(invoice);
  invoiceDao.notifyOfPaymentAttempt(new InvoicePayment(invoice.getId(),paymentAmount,Currency.USD,paymentAttemptId,paymentAttemptDate));
  invoice=invoiceDao.getById(invoice.getId().toString());
  assertEquals(invoice.getAmountPaid().compareTo(paymentAmount),0);
  assertTrue(invoice.getLastPaymentAttempt().equals(paymentAttemptDate));
}
