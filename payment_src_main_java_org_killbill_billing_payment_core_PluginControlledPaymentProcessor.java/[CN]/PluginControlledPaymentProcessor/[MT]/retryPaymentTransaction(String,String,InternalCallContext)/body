{
  try {
    final PaymentAttemptModelDao attempt=paymentDao.getPaymentAttemptByExternalKey(transactionExternalKey,internalCallContext);
    final PaymentTransactionModelDao transaction=paymentDao.getDirectPaymentTransactionByExternalKey(transactionExternalKey,internalCallContext);
    final PaymentModelDao payment=transaction != null ? paymentDao.getDirectPayment(transaction.getPaymentId(),internalCallContext) : null;
    final UUID paymentId=payment != null ? payment.getId() : null;
    final List<PluginPropertyModelDao> properties=paymentDao.getProperties(transactionExternalKey,internalCallContext);
    final List<PluginProperty> pluginProperties=properties == null ? ImmutableList.<PluginProperty>of() : ImmutableList.<PluginProperty>copyOf(Iterables.transform(properties,new Function<PluginPropertyModelDao,PluginProperty>(){
      @Nullable @Override public PluginProperty apply(      final PluginPropertyModelDao input){
        return new PluginProperty(input.getPropKey(),input.getPropValue(),false);
      }
    }
));
    final Account account=accountInternalApi.getAccountById(attempt.getAccountId(),internalCallContext);
    final UUID tenantId=nonEntityDao.retrieveIdFromObject(internalCallContext.getTenantRecordId(),ObjectType.TENANT);
    final CallContext callContext=internalCallContext.toCallContext(tenantId);
    final State state=pluginControlledDirectPaymentAutomatonRunner.fetchState(attempt.getStateName());
    pluginControlledDirectPaymentAutomatonRunner.run(state,false,attempt.getTransactionType(),account,attempt.getPaymentMethodId(),paymentId,attempt.getPaymentExternalKey(),attempt.getTransactionExternalKey(),attempt.getAmount(),attempt.getCurrency(),pluginProperties,pluginName,callContext,internalCallContext);
  }
 catch (  AccountApiException e) {
    e.printStackTrace();
  }
catch (  PaymentApiException e) {
    e.printStackTrace();
  }
}
