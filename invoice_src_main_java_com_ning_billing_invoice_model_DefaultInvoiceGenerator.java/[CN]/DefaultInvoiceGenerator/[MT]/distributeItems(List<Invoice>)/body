{
  Map<UUID,Invoice> invoiceMap=new HashMap<UUID,Invoice>();
  for (  Invoice invoice : invoices) {
    invoiceMap.put(invoice.getId(),invoice);
  }
  for (  final Invoice invoice : invoices) {
    Iterator<InvoiceItem> itemIterator=invoice.getInvoiceItems().iterator();
    final UUID invoiceId=invoice.getId();
    while (itemIterator.hasNext()) {
      InvoiceItem item=itemIterator.next();
      if (!item.getInvoiceId().equals(invoiceId)) {
        invoiceMap.get(item.getInvoiceId()).addInvoiceItem(item);
        itemIterator.remove();
      }
    }
  }
}
