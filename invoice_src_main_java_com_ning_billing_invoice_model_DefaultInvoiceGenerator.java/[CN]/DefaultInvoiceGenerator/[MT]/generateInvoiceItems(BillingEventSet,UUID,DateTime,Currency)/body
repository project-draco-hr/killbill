{
  InvoiceItemList items=new InvoiceItemList();
  Collections.sort(events);
  for (int i=0; i < (events.size() - 1); i++) {
    BillingEvent thisEvent=events.get(i);
    BillingEvent nextEvent=events.get(i + 1);
    if (thisEvent.getSubscription().getId().equals(nextEvent.getSubscription().getId())) {
      processEvents(invoiceId,thisEvent,nextEvent,items,targetDate,targetCurrency);
    }
 else {
      processEvent(invoiceId,thisEvent,items,targetDate,targetCurrency);
    }
  }
  if (events.size() > 0) {
    processEvent(invoiceId,events.getLast(),items,targetDate,targetCurrency);
  }
  return items;
}
