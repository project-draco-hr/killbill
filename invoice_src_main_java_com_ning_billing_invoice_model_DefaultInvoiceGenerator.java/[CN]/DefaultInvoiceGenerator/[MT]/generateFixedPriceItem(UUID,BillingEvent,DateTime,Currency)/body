{
  if (thisEvent.getEffectiveDate().isAfter(targetDate)) {
    return null;
  }
 else {
    FixedPriceInvoiceItem fixedPriceInvoiceItem=null;
    if (thisEvent.getFixedPrice() != null) {
      try {
        BigDecimal fixedPrice=thisEvent.getFixedPrice().getPrice(currency);
        fixedPriceInvoiceItem=new FixedPriceInvoiceItem(invoiceId,thisEvent.getSubscription().getId(),thisEvent.getPlan().getName(),thisEvent.getPlanPhase().getName(),thisEvent.getEffectiveDate(),fixedPrice,currency);
      }
 catch (      CatalogApiException e) {
        throw new InvoiceApiException(e,ErrorCode.CAT_NO_PRICE_FOR_CURRENCY,currency.toString());
      }
    }
    return fixedPriceInvoiceItem;
  }
}
