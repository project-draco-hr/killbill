{
  if (events == null) {
    return null;
  }
  if (events.size() == 0) {
    return null;
  }
  DefaultInvoice invoice=new DefaultInvoice(accountId,targetDate,targetCurrency);
  InvoiceItemList currentItems=generateInvoiceItems(events,invoice.getId(),targetDate,targetCurrency);
  InvoiceItemList itemsToPost=reconcileInvoiceItems(invoice.getId(),currentItems,existingItems);
  if (itemsToPost.size() == 0) {
    return null;
  }
 else {
    invoice.addInvoiceItems(itemsToPost);
    return invoice;
  }
}
