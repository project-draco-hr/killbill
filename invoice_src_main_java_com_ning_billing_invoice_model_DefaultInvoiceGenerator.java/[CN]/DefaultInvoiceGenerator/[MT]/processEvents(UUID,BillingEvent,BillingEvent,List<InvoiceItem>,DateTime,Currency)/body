{
  BigDecimal rate=firstEvent.getPrice(targetCurrency);
  BigDecimal invoiceItemAmount=calculateInvoiceItemAmount(firstEvent,secondEvent,targetDate,rate);
  BillingMode billingMode=getBillingMode(firstEvent.getBillingMode());
  DateTime billThroughDate=billingMode.calculateEffectiveEndDate(firstEvent.getEffectiveDate(),secondEvent.getEffectiveDate(),targetDate,firstEvent.getBillCycleDay(),firstEvent.getBillingPeriod());
  addInvoiceItem(invoiceId,items,firstEvent,billThroughDate,invoiceItemAmount,rate,targetCurrency);
}
