{
  final Payment payment=createAccountWithInvoiceAndPayment();
  final Chargeback input=new Chargeback();
  input.setAmount(new BigDecimal("50.00"));
  input.setPaymentId(payment.getPaymentId());
  int count=4;
  while (count-- > 0) {
    assertNotNull(killBillClient.createChargeBack(input,createdBy,reason,comment));
  }
  try {
    killBillClient.createChargeBack(input,createdBy,reason,comment);
    fail();
  }
 catch (  final KillBillClientException e) {
  }
  List<Chargeback> chargebacks=killBillClient.getChargebacksForAccount(payment.getAccountId());
  assertEquals(chargebacks.size(),4);
  for (  final Chargeback chargeBack : chargebacks) {
    assertTrue(chargeBack.getAmount().compareTo(input.getAmount()) == 0);
    assertEquals(chargeBack.getPaymentId(),input.getPaymentId());
  }
  chargebacks=killBillClient.getChargebacksForPayment(payment.getPaymentId());
  assertEquals(chargebacks.size(),4);
}
