{
  final LocalDate startDate=new LocalDate(2013,12,13);
  final LocalDate endDate=new LocalDate(2014,1,12);
  final LocalDate nextEndDate=new LocalDate(2014,1,13);
  final BigDecimal rate1=new BigDecimal("12.00");
  final BigDecimal amount1=rate1;
  final BigDecimal rate2=new BigDecimal("14.85");
  final BigDecimal amount2=rate2;
  final UUID firstInvoiceId=UUID.randomUUID();
  final List<InvoiceItem> existing=new LinkedList<InvoiceItem>();
  final InvoiceItem item1=new RecurringInvoiceItem(firstInvoiceId,accountId,bundleId,subscriptionId,planName,phaseName,startDate,endDate,amount1,rate1,currency);
  existing.add(item1);
  final List<InvoiceItem> proposed=new LinkedList<InvoiceItem>();
  final InvoiceItem other=new RecurringInvoiceItem(invoiceId,accountId,bundleId,subscriptionId,planName,phaseName,endDate,nextEndDate,amount2,rate2,currency);
  proposed.add(other);
  defaultInvoiceGenerator.addRepairItems(existing,proposed);
  assertEquals(existing.size(),1);
  assertEquals(proposed.size(),2);
  assertEquals(proposed.get(0),other);
  final InvoiceItem newItem2=proposed.get(1);
  assertEquals(newItem2.getInvoiceId(),firstInvoiceId);
  assertEquals(newItem2.getInvoiceItemType(),InvoiceItemType.REPAIR_ADJ);
  assertEquals(newItem2.getAmount(),item1.getAmount().negate());
  assertEquals(newItem2.getLinkedItemId(),item1.getId());
  assertEquals(newItem2.getStartDate(),startDate);
  assertEquals(newItem2.getEndDate(),endDate);
}
