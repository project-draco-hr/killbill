{
  if (paymentId == null) {
    return;
  }
  final Account account;
  try {
    account=accountApi.getAccountById(accountId,context);
  }
 catch (  AccountApiException e) {
    log.warn("Ignoring payment {}: account {} does not exist",paymentId,accountId);
    return;
  }
  final Payment payment;
  try {
    payment=paymentApi.getPayment(paymentId,context);
  }
 catch (  PaymentApiException e) {
    log.warn("Ignoring payment {}: payment does not exist",paymentId);
    return;
  }
  PaymentMethod paymentMethod=null;
  try {
    paymentMethod=paymentApi.getPaymentMethod(account,payment.getPaymentMethodId(),true,context);
  }
 catch (  PaymentApiException e) {
    log.info("For payment {}: payment method {} does not exist",paymentId,payment.getPaymentMethodId());
  }
  Invoice invoice=null;
  InvoicePayment invoicePayment=null;
  try {
    invoicePayment=invoiceApi.getInvoicePaymentForAttempt(paymentId,context);
    if (invoicePayment != null) {
      invoice=invoiceApi.getInvoiceById(invoicePayment.getInvoiceId(),context);
    }
  }
 catch (  InvoiceApiException e) {
    log.warn("Unable to find invoice {} for payment {}",invoicePayment != null ? invoicePayment.getInvoiceId() : "unknown",paymentId);
  }
  createPayment(account,invoice,invoicePayment,payment,paymentMethod,extFirstPaymentRefId,extSecondPaymentRefId,message,context);
}
