{
  final Currency currency=Currency.USD;
  final Invoice invoice=generator.generateInvoice(accountId,events,existingInvoices,targetDate,DateTimeZone.UTC,currency);
  assertNotNull(invoice);
  assertEquals(invoice.getNumberOfItems(),expectedNumberOfItems);
  existingInvoices.add(invoice);
  distributeItems(existingInvoices);
  assertEquals(invoice.getBalance(),expectedAmount);
}
