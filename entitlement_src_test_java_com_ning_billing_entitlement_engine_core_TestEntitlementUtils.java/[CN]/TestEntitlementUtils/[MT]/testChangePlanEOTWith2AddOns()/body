{
  testListener.pushExpectedEvents(NextEvent.CREATE);
  final PlanPhaseSpecifier secondAddOnSpec=new PlanPhaseSpecifier("Laser-Scope",ProductCategory.ADD_ON,BillingPeriod.MONTHLY,PriceListSet.DEFAULT_PRICELIST_NAME,null);
  final DefaultEntitlement secondAddOnEntitlement=(DefaultEntitlement)entitlementApi.addEntitlement(baseEntitlement.getBundleId(),secondAddOnSpec,clock.getUTCToday(),callContext);
  assertListenerStatus();
  final DefaultEntitlement changedBaseEntitlement=(DefaultEntitlement)baseEntitlement.changePlanWithDate("Assault-Rifle",BillingPeriod.MONTHLY,PriceListSet.DEFAULT_PRICELIST_NAME,new LocalDate(2013,10,7),callContext);
  assertListenerStatus();
  checkBlockingStatesDAO(changedBaseEntitlement,addOnEntitlement,baseEffectiveCancellationOrChangeDate,false);
  final List<BlockingState> blockingStatesForSecondAddOn=blockingStateDao.getBlockingAll(secondAddOnEntitlement.getId(),BlockingStateType.SUBSCRIPTION,internalCallContext);
  Assert.assertEquals(blockingStatesForSecondAddOn.size(),0);
}
