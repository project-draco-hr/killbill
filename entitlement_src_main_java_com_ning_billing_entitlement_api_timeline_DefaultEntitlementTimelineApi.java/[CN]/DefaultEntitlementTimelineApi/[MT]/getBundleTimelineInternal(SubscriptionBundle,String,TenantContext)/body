{
  try {
    if (bundle == null) {
      throw new EntitlementRepairException(ErrorCode.ENT_REPAIR_UNKNOWN_BUNDLE,descBundle);
    }
    final List<Subscription> subscriptions=dao.getSubscriptions(factory,bundle.getId(),internalCallContextFactory.createInternalTenantContext(context));
    if (subscriptions.size() == 0) {
      throw new EntitlementRepairException(ErrorCode.ENT_REPAIR_NO_ACTIVE_SUBSCRIPTIONS,bundle.getId());
    }
    final String viewId=getViewId(((SubscriptionBundleData)bundle).getLastSysUpdateDate(),subscriptions);
    final List<SubscriptionTimeline> repairs=createGetSubscriptionRepairList(subscriptions,Collections.<SubscriptionTimeline>emptyList());
    return createGetBundleRepair(bundle.getId(),bundle.getExternalKey(),viewId,repairs);
  }
 catch (  CatalogApiException e) {
    throw new EntitlementRepairException(e);
  }
}
