{
  try {
    final SubscriptionBundle bundle=dao.getSubscriptionBundleFromId(bundleId);
    if (bundle == null) {
      throw new EntitlementRepairException(ErrorCode.ENT_REPAIR_UNKNOWN_BUNDLE,bundleId);
    }
    final List<Subscription> subscriptions=dao.getSubscriptions(factory,bundleId);
    if (subscriptions.size() == 0) {
      throw new EntitlementRepairException(ErrorCode.ENT_REPAIR_NO_ACTIVE_SUBSCRIPTIONS,bundleId);
    }
    final String viewId=getViewId(((SubscriptionBundleData)bundle).getLastSysUpdateTime(),subscriptions);
    final List<SubscriptionTimeline> repairs=createGetSubscriptionRepairList(subscriptions,Collections.<SubscriptionTimeline>emptyList());
    return createGetBundleRepair(bundleId,bundle.getKey(),viewId,repairs);
  }
 catch (  CatalogApiException e) {
    throw new EntitlementRepairException(e);
  }
}
