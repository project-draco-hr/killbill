{
  final List<PaymentTransactionInfoPlugin> flattenedTransactions=ImmutableList.copyOf(Iterables.concat(payments.values()));
  final Collection<PaymentTransactionInfoPlugin> filteredTransactions=Collections2.<PaymentTransactionInfoPlugin>filter(flattenedTransactions,new Predicate<PaymentTransactionInfoPlugin>(){
    @Override public boolean apply(    final PaymentTransactionInfoPlugin input){
      return (input.getKbPaymentId() != null && input.getKbPaymentId().toString().equals(searchKey)) || (input.getFirstPaymentReferenceId() != null && input.getFirstPaymentReferenceId().contains(searchKey)) || (input.getSecondPaymentReferenceId() != null && input.getSecondPaymentReferenceId().contains(searchKey));
    }
  }
);
  final ImmutableList<PaymentTransactionInfoPlugin> allResults=ImmutableList.<PaymentTransactionInfoPlugin>copyOf(filteredTransactions);
  final List<PaymentTransactionInfoPlugin> results;
  if (offset >= allResults.size()) {
    results=ImmutableList.<PaymentTransactionInfoPlugin>of();
  }
 else   if (offset + limit > allResults.size()) {
    results=allResults.subList(offset.intValue(),allResults.size());
  }
 else {
    results=allResults.subList(offset.intValue(),offset.intValue() + limit.intValue());
  }
  return new DefaultPagination<PaymentTransactionInfoPlugin>(offset,limit,(long)results.size(),(long)payments.values().size(),results.iterator());
}
