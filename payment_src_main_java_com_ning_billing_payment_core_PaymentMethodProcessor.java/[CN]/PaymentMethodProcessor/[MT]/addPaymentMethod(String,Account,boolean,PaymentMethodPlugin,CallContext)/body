{
  PaymentMethod pm=null;
  PaymentPluginApi pluginApi=null;
  try {
    pluginApi=getPaymentProviderPlugin(account.getExternalKey());
    pm=new DefaultPaymentMethod(account.getId(),pluginName,paymentMethodProps);
    String externalId=pluginApi.addPaymentMethod(account.getExternalKey(),paymentMethodProps,setDefault);
    PaymentMethodModelDao pmModel=new PaymentMethodModelDao(pm.getId(),pm.getAccountId(),pm.getPluginName(),pm.isActive(),externalId);
    paymentDao.insertPaymentMethod(pmModel,context);
  }
 catch (  PaymentPluginApiException e) {
    throw new PaymentApiException(ErrorCode.PAYMENT_ADD_PAYMENT_METHOD,account.getId(),e.getErrorMessage());
  }
  return pm.getId();
}
