{
  final Attributes.Name attrName=new Attributes.Name(Constants.BUNDLE_SYMBOLICNAME);
  final JarInputStream in=new JarInputStream(new FileInputStream(new File(rubyJar)));
  final Manifest manifest=in.getManifest();
  final Object currentValue=manifest.getMainAttributes().get(attrName);
  manifest.getMainAttributes().put(attrName,currentValue.toString() + "-" + index);
  final ByteArrayOutputStream out=new ByteArrayOutputStream();
  final JarOutputStream jarOut=new JarOutputStream(out,manifest);
  try {
    JarEntry e=in.getNextJarEntry();
    while (e != null) {
      if (!e.getName().equals(JarFile.MANIFEST_NAME)) {
        jarOut.putNextEntry(e);
        ByteStreams.copy(in,jarOut);
      }
      e=in.getNextJarEntry();
    }
  }
  finally {
    if (jarOut != null) {
      jarOut.close();
    }
  }
  return new ByteArrayInputStream(out.toByteArray());
}
