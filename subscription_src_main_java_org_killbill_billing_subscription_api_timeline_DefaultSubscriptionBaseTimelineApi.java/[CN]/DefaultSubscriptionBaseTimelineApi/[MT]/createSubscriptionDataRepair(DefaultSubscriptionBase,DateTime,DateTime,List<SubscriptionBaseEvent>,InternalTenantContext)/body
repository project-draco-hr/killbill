{
  final SubscriptionBuilder builder=new SubscriptionBuilder(curData);
  builder.setActiveVersion(curData.getActiveVersion() + 1);
  if (newBundleStartDate != null) {
    builder.setBundleStartDate(newBundleStartDate);
  }
  if (newSubscriptionStartDate != null) {
    builder.setAlignStartDate(newSubscriptionStartDate);
  }
  if (initialEvents.size() > 0) {
    for (    final SubscriptionBaseEvent cur : initialEvents) {
      cur.setActiveVersion(builder.getActiveVersion());
    }
  }
  final SubscriptionDataRepair subscriptiondataRepair=new SubscriptionDataRepair(builder,curData.getEvents(),repairApiService,(SubscriptionDao)repairDao,clock,addonUtils,catalogService,internalCallContextFactory);
  final Catalog fullCatalog=catalogService.getFullCatalog(tenantContext);
  subscriptiondataRepair.rebuildTransitions(curData.getEvents(),fullCatalog);
  return subscriptiondataRepair;
}
