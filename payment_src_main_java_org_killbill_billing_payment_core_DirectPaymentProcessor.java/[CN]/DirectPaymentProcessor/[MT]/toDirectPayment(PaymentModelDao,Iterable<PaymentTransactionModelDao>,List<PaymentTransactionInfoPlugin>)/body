{
  final Ordering<DirectPaymentTransaction> perPaymentTransactionOrdering=Ordering.<DirectPaymentTransaction>from(new Comparator<DirectPaymentTransaction>(){
    @Override public int compare(    final DirectPaymentTransaction o1,    final DirectPaymentTransaction o2){
      return o1.getEffectiveDate().compareTo(o2.getEffectiveDate());
    }
  }
);
  final Iterable<PaymentTransactionModelDao> filteredTransactions=Iterables.filter(transactionsModelDao,new Predicate<PaymentTransactionModelDao>(){
    @Override public boolean apply(    final PaymentTransactionModelDao curDirectPaymentTransactionModelDao){
      return curDirectPaymentTransactionModelDao.getPaymentId().equals(curPaymentModelDao.getId());
    }
  }
);
  final Iterable<DirectPaymentTransaction> transactions=Iterables.transform(filteredTransactions,new Function<PaymentTransactionModelDao,DirectPaymentTransaction>(){
    @Override public DirectPaymentTransaction apply(    final PaymentTransactionModelDao input){
      final PaymentTransactionInfoPlugin info=pluginTransactions != null ? Iterables.tryFind(pluginTransactions,new Predicate<PaymentTransactionInfoPlugin>(){
        @Override public boolean apply(        final PaymentTransactionInfoPlugin input){
          return input.getKbTransactionPaymentId().equals(input.getKbTransactionPaymentId());
        }
      }
).orNull() : null;
      return new DefaultDirectPaymentTransaction(input.getId(),input.getTransactionExternalKey(),input.getCreatedDate(),input.getUpdatedDate(),input.getPaymentId(),input.getTransactionType(),input.getEffectiveDate(),input.getPaymentStatus(),input.getAmount(),input.getCurrency(),input.getProcessedAmount(),input.getProcessedCurrency(),input.getGatewayErrorCode(),input.getGatewayErrorMsg(),info);
    }
  }
);
  final List<DirectPaymentTransaction> sortedTransactions=perPaymentTransactionOrdering.immutableSortedCopy(transactions);
  return new DefaultDirectPayment(curPaymentModelDao.getId(),curPaymentModelDao.getCreatedDate(),curPaymentModelDao.getUpdatedDate(),curPaymentModelDao.getAccountId(),curPaymentModelDao.getPaymentMethodId(),curPaymentModelDao.getPaymentNumber(),curPaymentModelDao.getExternalKey(),sortedTransactions);
}
