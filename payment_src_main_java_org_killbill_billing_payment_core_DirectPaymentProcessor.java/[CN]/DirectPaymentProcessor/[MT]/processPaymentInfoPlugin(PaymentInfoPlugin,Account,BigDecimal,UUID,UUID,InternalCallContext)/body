{
  final PaymentStatus paymentStatus;
switch (infoPlugin.getStatus()) {
case PROCESSED:
    paymentStatus=PaymentStatus.SUCCESS;
  break;
case PENDING:
paymentStatus=PaymentStatus.PENDING;
break;
case ERROR:
paymentStatus=PaymentStatus.PLUGIN_FAILURE_ABORTED;
break;
case UNDEFINED:
default :
final String formatError=String.format("Plugin return status %s for direct payment %s",infoPlugin.getStatus(),directPaymentId);
throw new PaymentPluginApiException("",formatError);
}
paymentDao.updateDirectPaymentAndTransactionOnCompletion(directPaymentId,paymentStatus,amount,account.getCurrency(),directPaymentTransactionId,infoPlugin.getGatewayErrorCode(),infoPlugin.getGatewayError(),callContext);
return paymentStatus;
}
