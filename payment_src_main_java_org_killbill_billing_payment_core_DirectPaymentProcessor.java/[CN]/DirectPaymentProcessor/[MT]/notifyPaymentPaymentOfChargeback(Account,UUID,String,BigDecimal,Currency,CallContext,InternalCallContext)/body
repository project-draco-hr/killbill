{
  final DirectPaymentTransactionModelDao transactionModelDao=paymentDao.getDirectPaymentTransaction(transactionId,internalCallContext);
  Preconditions.checkState(transactionModelDao != null);
  final DateTime utcNow=clock.getUTCNow();
  final DirectPaymentTransactionModelDao chargebackTransaction=new DirectPaymentTransactionModelDao(utcNow,utcNow,chargebackTransactionExternalKey,transactionModelDao.getId(),TransactionType.CHARGEBACK,utcNow,PaymentStatus.SUCCESS,amount,currency,null,null);
  final State currentPaymentState=directPaymentAutomatonRunner.fetchNextState("CHARGEBACK_INIT",true);
  paymentDao.updateDirectPaymentWithNewTransaction(transactionModelDao.getId(),chargebackTransaction,internalCallContext);
  paymentDao.updateDirectPaymentAndTransactionOnCompletion(transactionModelDao.getId(),currentPaymentState.getName(),chargebackTransaction.getId(),PaymentStatus.SUCCESS,chargebackTransaction.getAmount(),chargebackTransaction.getCurrency(),chargebackTransaction.getGatewayErrorCode(),chargebackTransaction.getGatewayErrorMsg(),internalCallContext);
}
