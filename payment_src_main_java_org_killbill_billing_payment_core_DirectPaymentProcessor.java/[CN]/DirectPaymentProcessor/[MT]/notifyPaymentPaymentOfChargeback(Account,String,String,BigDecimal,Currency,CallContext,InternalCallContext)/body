{
  final DirectPaymentModelDao paymentModelDao=paymentDao.getDirectPaymentByExternalKey(paymentExternalKey,internalCallContext);
  Preconditions.checkState(paymentModelDao != null);
  final DateTime utcNow=clock.getUTCNow();
  final DirectPaymentTransactionModelDao chargebackTransaction=new DirectPaymentTransactionModelDao(utcNow,utcNow,chargebackExternalKey,paymentModelDao.getId(),TransactionType.CHARGEBACK,utcNow,PaymentStatus.SUCCESS,amount,currency,null,null);
  final State currentPaymentState=directPaymentAutomatonRunner.fetchNextState("CHARGEBACK_INIT",true);
  paymentDao.updateDirectPaymentWithNewTransaction(paymentModelDao.getId(),chargebackTransaction,internalCallContext);
  paymentDao.updateDirectPaymentAndTransactionOnCompletion(paymentModelDao.getId(),currentPaymentState.getName(),chargebackTransaction.getId(),PaymentStatus.SUCCESS,chargebackTransaction.getAmount(),chargebackTransaction.getCurrency(),chargebackTransaction.getGatewayErrorCode(),chargebackTransaction.getGatewayErrorMsg(),internalCallContext);
}
