{
  final DateTime effectiveTransitionTime=new DateTime(DateTimeZone.UTC);
  final DateTime requestedTransitionTime=new DateTime(DateTimeZone.UTC);
  final SubscriptionTransitionData firstTransition=createFirstSubscriptionTransition(requestedTransitionTime,effectiveTransitionTime);
  final BusinessSubscriptionTransition firstBST=createExpectedFirstBST(firstTransition.getId(),requestedTransitionTime,effectiveTransitionTime);
  listener.handleSubscriptionTransitionChange(firstTransition);
  Assert.assertEquals(dao.getTransitions(KEY).size(),1);
  Assert.assertEquals(dao.getTransitions(KEY).get(0),firstBST);
  final DateTime effectiveCancelTransitionTime=new DateTime(DateTimeZone.UTC);
  final DateTime requestedCancelTransitionTime=new DateTime(DateTimeZone.UTC);
  final SubscriptionTransitionData cancelledSubscriptionTransition=createCancelSubscriptionTransition(requestedCancelTransitionTime,effectiveCancelTransitionTime,firstTransition.getNextState());
  final BusinessSubscriptionTransition cancelledBST=createExpectedCancelledBST(cancelledSubscriptionTransition.getId(),requestedCancelTransitionTime,effectiveCancelTransitionTime,firstBST.getNextSubscription());
  listener.handleSubscriptionTransitionChange(cancelledSubscriptionTransition);
  Assert.assertEquals(dao.getTransitions(KEY).size(),2);
  Assert.assertEquals(dao.getTransitions(KEY).get(1),cancelledBST);
}
