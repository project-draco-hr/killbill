{
  final DateTime effectiveTransitionTime=new DateTime(DateTimeZone.UTC);
  final DateTime requestedTransitionTime=new DateTime(DateTimeZone.UTC);
  final SubscriptionTransition firstTransition=createFirstSubscriptionTransition(requestedTransitionTime,effectiveTransitionTime);
  final BusinessSubscriptionTransition firstBST=createExpectedFirstBST(requestedTransitionTime,effectiveTransitionTime);
  listener.handleNotificationChange(firstTransition);
  Assert.assertEquals(dao.getTransitions(KEY).size(),1);
  Assert.assertEquals(dao.getTransitions(KEY).get(0),firstBST);
  final DateTime effectivePauseTransitionTime=new DateTime(DateTimeZone.UTC);
  final DateTime requestedPauseTransitionTime=new DateTime(DateTimeZone.UTC);
  final SubscriptionTransition pausedSubscriptionTransition=createPauseSubscriptionTransition(effectivePauseTransitionTime,requestedPauseTransitionTime,firstTransition.getNextState());
  final BusinessSubscriptionTransition pausedBST=createExpectedPausedBST(requestedPauseTransitionTime,effectivePauseTransitionTime,firstBST.getNextSubscription());
  listener.handleNotificationChange(pausedSubscriptionTransition);
  Assert.assertEquals(dao.getTransitions(KEY).size(),2);
  Assert.assertEquals(dao.getTransitions(KEY).get(1),pausedBST);
  final DateTime effectiveResumeTransitionTime=new DateTime(DateTimeZone.UTC);
  final DateTime requestedResumeTransitionTime=new DateTime(DateTimeZone.UTC);
  final SubscriptionTransition resumedSubscriptionTransition=createResumeSubscriptionTransition(requestedResumeTransitionTime,effectiveResumeTransitionTime,pausedSubscriptionTransition.getNextState());
  final BusinessSubscriptionTransition resumedBST=createExpectedResumedBST(requestedResumeTransitionTime,effectiveResumeTransitionTime,pausedBST.getNextSubscription());
  listener.handleNotificationChange(resumedSubscriptionTransition);
  Assert.assertEquals(dao.getTransitions(KEY).size(),3);
  Assert.assertEquals(dao.getTransitions(KEY).get(2),resumedBST);
  final DateTime effectiveCancelTransitionTime=new DateTime(DateTimeZone.UTC);
  final DateTime requestedCancelTransitionTime=new DateTime(DateTimeZone.UTC);
  listener.handleNotificationChange(createCancelSubscriptionTransition(requestedCancelTransitionTime,effectiveCancelTransitionTime,resumedSubscriptionTransition.getNextState()));
  final BusinessSubscriptionTransition cancelledBST=createExpectedCancelledBST(requestedCancelTransitionTime,effectiveCancelTransitionTime,resumedBST.getNextSubscription());
  Assert.assertEquals(dao.getTransitions(KEY).size(),4);
  Assert.assertEquals(dao.getTransitions(KEY).get(3),cancelledBST);
}
