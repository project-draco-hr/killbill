{
  final InvoiceItem invoiceItem=invoiceUserApi.getInvoice(invoiceId).getInvoiceItems().get(0);
  Assert.assertEquals(invoiceItem.getAmount().compareTo(BigDecimal.ZERO),1);
  final BigDecimal invoiceBalance=invoiceUserApi.getInvoice(invoiceId).getBalance();
  Assert.assertEquals(invoiceBalance.compareTo(BigDecimal.ZERO),1);
  final BigDecimal accountBalance=invoiceUserApi.getAccountBalance(accountId);
  Assert.assertEquals(accountBalance,invoiceBalance);
  final BigDecimal adjAmount=invoiceItem.getAmount().divide(BigDecimal.TEN);
  final InvoiceItem adjInvoiceItem=invoiceUserApi.insertInvoiceItemAdjustment(accountId,invoiceId,invoiceItem.getId(),clock.getUTCToday(),adjAmount,accountCurrency,context);
  Assert.assertEquals(adjInvoiceItem.getInvoiceId(),invoiceId);
  Assert.assertEquals(adjInvoiceItem.getInvoiceItemType(),InvoiceItemType.ITEM_ADJ);
  Assert.assertEquals(adjInvoiceItem.getAccountId(),accountId);
  Assert.assertEquals(adjInvoiceItem.getAmount(),adjAmount.negate());
  Assert.assertEquals(adjInvoiceItem.getCurrency(),accountCurrency);
  Assert.assertEquals(adjInvoiceItem.getLinkedItemId(),invoiceItem.getId());
  final BigDecimal adjustedInvoiceBalance=invoiceUserApi.getInvoice(invoiceId).getBalance();
  Assert.assertEquals(adjustedInvoiceBalance,invoiceBalance.add(adjAmount.negate()).setScale(InvoicingConfiguration.getNumberOfDecimals(),InvoicingConfiguration.getRoundingMode()));
  final BigDecimal adjustedAccountBalance=invoiceUserApi.getAccountBalance(accountId);
  Assert.assertEquals(adjustedAccountBalance,adjustedInvoiceBalance);
}
