{
  final DateTime initialDate=new DateTime(2015,11,1,0,3,42,0);
  clock.setDeltaFromReality(initialDate.getMillis() - clock.getUTCNow().getMillis());
  final Account accountJson=createAccountWithDefaultPaymentMethod();
  final BillingPeriod term=BillingPeriod.MONTHLY;
  final String externalKey="bundleKey";
  final Subscription baseEntitlementJson=createEntitlement(accountJson.getAccountId(),externalKey,"Shotgun",ProductCategory.BASE,term,true);
  final Subscription input=new Subscription();
  input.setAccountId(accountJson.getAccountId());
  input.setBundleId(baseEntitlementJson.getBundleId());
  input.setExternalKey("ignoreExternalkey");
  input.setProductName("Telescopic-Scope");
  input.setProductCategory(ProductCategory.ADD_ON);
  input.setBillingPeriod(term);
  input.setPriceList(PriceListSet.DEFAULT_PRICELIST_NAME);
  final Subscription addOnEntitlementJson=killBillClient.createSubscription(input,DEFAULT_WAIT_COMPLETION_TIMEOUT_SEC,createdBy,reason,comment);
  Bundle bundleJson=killBillClient.getBundle(externalKey);
  final List<Subscription> subscriptions=bundleJson.getSubscriptions();
  assertEquals(subscriptions.size(),2);
  assertTrue(baseEntitlementJson.equals(subscriptions.get(0)));
  assertTrue(addOnEntitlementJson.equals(subscriptions.get(1)));
}
