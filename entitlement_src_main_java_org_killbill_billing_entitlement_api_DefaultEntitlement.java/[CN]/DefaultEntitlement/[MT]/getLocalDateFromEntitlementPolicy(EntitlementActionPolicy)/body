{
  final LocalDate cancellationDate;
switch (entitlementPolicy) {
case IMMEDIATE:
    cancellationDate=new LocalDate(clock.getUTCNow(),eventsStream.getAccountTimeZone());
  break;
case END_OF_TERM:
cancellationDate=getSubscriptionBase().getChargedThroughDate() != null ? new LocalDate(getSubscriptionBase().getChargedThroughDate(),eventsStream.getAccountTimeZone()) : new LocalDate(clock.getUTCNow(),eventsStream.getAccountTimeZone());
break;
default :
throw new RuntimeException("Unsupported policy " + entitlementPolicy);
}
return (cancellationDate.compareTo(getEffectiveStartDate()) < 0) ? getEffectiveStartDate() : cancellationDate;
}
