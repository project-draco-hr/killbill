{
  if (invoice.getBalance().compareTo(BigDecimal.ZERO) <= 0) {
    throw new PaymentApiException(ErrorCode.PAYMENT_NULL_INVOICE,invoice.getId());
  }
  if (isInstantPayment && inputAmount != null && invoice.getBalance().compareTo(inputAmount) < 0) {
    throw new PaymentApiException(ErrorCode.PAYMENT_AMOUNT_DENIED,invoice.getId(),inputAmount.floatValue(),invoice.getBalance().floatValue());
  }
  final BigDecimal result=inputAmount != null ? inputAmount : invoice.getBalance();
  return result.setScale(2,RoundingMode.HALF_UP);
}
