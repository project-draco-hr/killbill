{
  Assert.assertTrue(basePath.mkdir());
  System.setProperty("killbill.usage.timelines.spoolDir",basePath.getAbsolutePath());
  final MeterConfig config=new ConfigurationObjectFactory(System.getProperties()).build(MeterConfig.class);
  timelineEventHandler=new TimelineEventHandler(config,dao,timelineCoder,sampleCoder,new BackgroundDBChunkWriter(dao,config,internalCallContextFactory),new FileBackedBuffer(config.getSpoolDir(),"TimelineEventHandler",1024 * 1024,10));
  dao.getOrAddSource(HOST_UUID.toString(),internalCallContext);
  eventTypeId=dao.getOrAddEventCategory(EVENT_TYPE,internalCallContext);
}
