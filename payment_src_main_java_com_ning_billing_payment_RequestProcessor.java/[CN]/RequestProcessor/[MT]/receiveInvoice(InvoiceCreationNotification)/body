{
  final Invoice invoice=invoiceApi.getInvoice(event.getInvoiceId());
  if (invoice == null) {
  }
 else {
    final Account account=accountUserApi.getAccountById(event.getAccountId());
    if (account == null) {
    }
 else {
      final String paymentProviderName=account.getFieldValue(PAYMENT_PROVIDER_KEY);
      final PaymentProviderPlugin plugin=pluginRegistry.getPlugin(paymentProviderName);
      Either<PaymentError,PaymentInfo> result=plugin.processInvoice(account,invoice);
      eventBus.post(result.isLeft() ? result.getLeft() : result.getRight());
    }
  }
}
