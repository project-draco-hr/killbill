{
  final IAccount account=accountUserApi.getAccountFromId(invoice.getAccountId());
  final String paymentProviderName=account.getFieldValue(PAYMENT_PROVIDER_KEY);
  final PaymentProviderPlugin plugin=pluginRegistry.getPlugin(paymentProviderName);
  Either<PaymentError,PaymentInfo> result=plugin.processInvoice(account,invoice);
  eventBus.post(result.isLeft() ? result.getLeft() : result.getRight());
}
