{
synchronized (events) {
    boolean foundCancel=false;
    final Iterator<SubscriptionEvent> it=events.descendingIterator();
    while (it.hasNext()) {
      final SubscriptionEvent cur=it.next();
      if (cur.getSubscriptionId() != subscription.getId()) {
        continue;
      }
      if (cur.getType() == EventType.API_USER && ((ApiEvent)cur).getEventType() == ApiEventType.CANCEL) {
        cur.deactivate();
        foundCancel=true;
        break;
      }
    }
    if (foundCancel) {
      for (      final SubscriptionEvent cur : uncancelEvents) {
        insertEvent(cur,context);
      }
    }
  }
}
