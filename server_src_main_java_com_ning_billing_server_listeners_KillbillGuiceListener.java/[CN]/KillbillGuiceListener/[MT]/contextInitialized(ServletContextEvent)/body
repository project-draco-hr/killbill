{
  final ServerModuleBuilder builder=new ServerModuleBuilder().addConfig(KillbillServerConfig.class).addHealthCheck(KillbillHealthcheck.class).addJMXExport(KillbillHealthcheck.class).addModule(new KillbillServerModule()).addJerseyResource("com.ning.billing.jaxrs.resources");
  guiceModule=builder.build();
  super.contextInitialized(event);
  logger.info("KillbillLifecycleListener : contextInitialized");
  final Injector injector=injector(event);
  killbillLifecycle=injector.getInstance(DefaultLifecycle.class);
  killbillBusService=injector.getInstance(BusService.class);
  killbilleventHandler=new KillbillEventHandler();
  killbillLifecycle.fireStartupSequencePriorEventRegistration();
  try {
    killbillBusService.getBus().register(killbilleventHandler);
  }
 catch (  Bus.EventBusException e) {
    logger.error("Failed to register for event notifications, this is bad exiting!",e);
    System.exit(1);
  }
  killbillLifecycle.fireStartupSequencePostEventRegistration();
}
