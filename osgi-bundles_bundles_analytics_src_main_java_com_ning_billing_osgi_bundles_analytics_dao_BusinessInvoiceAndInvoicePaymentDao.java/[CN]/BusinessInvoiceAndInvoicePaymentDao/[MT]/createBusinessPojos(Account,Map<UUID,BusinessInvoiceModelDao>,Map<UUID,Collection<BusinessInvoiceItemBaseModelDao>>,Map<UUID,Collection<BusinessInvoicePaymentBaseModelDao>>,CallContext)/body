{
  final Map<BusinessInvoiceModelDao,Collection<BusinessInvoiceItemBaseModelDao>> businessInvoices=businessInvoiceDao.createBusinessInvoicesAndInvoiceItems(account,context);
  final Collection<BusinessInvoicePaymentBaseModelDao> businessInvoicePayments=businessInvoicePaymentDao.createBusinessInvoicePayments(account,businessInvoices,context);
  for (  final BusinessInvoiceModelDao businessInvoice : businessInvoices.keySet()) {
    invoices.put(businessInvoice.getInvoiceId(),businessInvoice);
    for (    final BusinessInvoiceItemBaseModelDao businessInvoiceItem : businessInvoices.get(businessInvoice)) {
      if (invoiceItems.get(businessInvoice.getInvoiceId()) == null) {
        invoiceItems.put(businessInvoice.getInvoiceId(),new LinkedList<BusinessInvoiceItemBaseModelDao>());
      }
      invoiceItems.get(businessInvoice.getInvoiceId()).add(businessInvoiceItem);
    }
  }
  for (  final BusinessInvoicePaymentBaseModelDao businessInvoicePayment : businessInvoicePayments) {
    if (invoicePayments.get(businessInvoicePayment.getInvoiceId()) == null) {
      invoicePayments.put(businessInvoicePayment.getInvoiceId(),new LinkedList<BusinessInvoicePaymentBaseModelDao>());
    }
    invoicePayments.get(businessInvoicePayment.getInvoiceId()).add(businessInvoicePayment);
  }
  populatedMissingDenormalizedFields(invoices,invoiceItems,invoicePayments);
}
