{
  final Subscription subscription=getSubscription(invoiceItem.getSubscriptionId(),context);
  try {
    final Catalog catalog=getCatalog(context);
    return catalog.findPhase(invoiceItem.getPhaseName(),invoiceItem.getStartDate().toDateTimeAtStartOfDay(),subscription.getStartDate());
  }
 catch (  CatalogApiException e) {
    logService.log(LogService.LOG_WARNING,"Unable to retrieve phase for invoice item " + invoiceItem.getId(),e);
    throw new AnalyticsRefreshException(e);
  }
}
