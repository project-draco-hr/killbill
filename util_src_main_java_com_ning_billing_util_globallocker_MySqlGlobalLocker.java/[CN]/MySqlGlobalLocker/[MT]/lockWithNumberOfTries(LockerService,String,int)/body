{
  final String lockName=getLockName(service,lockKey);
  int tries_left=retry;
  while (tries_left-- > 0) {
    GlobalLock lock=lock(lockName);
    if (lock != null) {
      return lock;
    }
  }
  logger.error(String.format("Failed to acquire lock %s for service %s after %d retry",lockKey,service,retry));
  throw new LockFailedException();
}
