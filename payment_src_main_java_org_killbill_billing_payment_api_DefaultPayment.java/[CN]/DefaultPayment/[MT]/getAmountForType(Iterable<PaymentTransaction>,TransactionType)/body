{
  BigDecimal result=BigDecimal.ZERO;
  BigDecimal processedResult=BigDecimal.ZERO;
  boolean shouldUseProcessedAmount=true;
  for (  final PaymentTransaction transaction : transactions) {
    if (transaction.getTransactionType() != transactiontype || !TransactionStatus.SUCCESS.equals(transaction.getTransactionStatus())) {
      continue;
    }
    result=result.add(transaction.getAmount());
    shouldUseProcessedAmount=shouldUseProcessedAmount && transaction.getCurrency().equals(transaction.getProcessedCurrency()) && transaction.getProcessedAmount() != null;
    processedResult=shouldUseProcessedAmount ? processedResult.add(transaction.getProcessedAmount()) : BigDecimal.ZERO;
    if (TransactionType.AUTHORIZE.equals(transactiontype)) {
      break;
    }
  }
  return shouldUseProcessedAmount ? processedResult : result;
}
