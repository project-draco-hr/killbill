{
  if (event.getType() != ServiceEvent.REGISTERED && event.getType() != ServiceEvent.UNREGISTERING) {
    return;
  }
  final ServiceReference serviceReference=event.getServiceReference();
  final String pluginName=(String)serviceReference.getProperty("killbill.pluginName");
  if (pluginName == null) {
    return;
  }
  HttpServlet httpServlet=null;
  final String[] objectClass=(String[])event.getServiceReference().getProperty("objectClass");
  if (context != null && objectClass != null && objectClass.length > 0 && HttpServlet.class.getName().equals(objectClass[0])) {
    final Object service=context.getService(serviceReference);
    httpServlet=(HttpServlet)service;
  }
  if (httpServlet == null) {
    return;
  }
  if (event.getType() == ServiceEvent.REGISTERED) {
    servletRouter.registerServlet(pluginName,httpServlet);
  }
 else   if (event.getType() == ServiceEvent.UNREGISTERING) {
    servletRouter.unregisterServlet(pluginName);
  }
}
