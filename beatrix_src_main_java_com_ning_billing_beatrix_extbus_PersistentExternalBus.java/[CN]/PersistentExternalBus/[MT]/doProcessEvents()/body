{
  final List<BusEventEntry> events=getNextBusEvent();
  if (events.size() == 0) {
    return 0;
  }
  int result=0;
  for (  final BusEventEntry cur : events) {
    final String jsonWithAccountAndTenantRecorId=tweakJsonToIncludeAccountAndTenantRecordId(cur.getBusEventJson(),cur.getAccountRecordId(),cur.getTenantRecordId());
    final BusPersistentEvent evt=deserializeEvent(cur.getBusEventClass(),objectMapper,jsonWithAccountAndTenantRecorId);
    result++;
    eventBusDelegate.post(evt);
    dao.clearBusEvent(cur.getId(),com.ning.billing.Hostname.get(),bus_ext_events);
  }
  return result;
}
