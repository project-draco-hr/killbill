{
  final InternalCallContext context=internalCallContextFactory.createInternalCallContext(InternalCallContextFactory.INTERNAL_TENANT_RECORD_ID,null,"ExtPersistentBus",CallOrigin.INTERNAL,UserType.SYSTEM,null);
  final List<ExtBusEventEntry> events=getNextBusEvent(context);
  if (events.size() == 0) {
    return 0;
  }
  int result=0;
  for (  final ExtBusEventEntry cur : events) {
    final UUID accountId;
    if (cur.getObjectType() == ObjectType.ACCOUNT && cur.getExtBusType() == ExtBusEventType.ACCOUNT_CREATION) {
      accountId=cur.getObjectId();
    }
 else {
      accountId=getAccountIdFromRecordId(cur.getAccountRecordId(),context);
    }
    final ExtBusEvent event=new DefaultBusEvent(cur.getExtBusType(),cur.getObjectType(),cur.getObjectId(),accountId,null);
    result++;
    eventBusDelegate.post(event);
    final InternalCallContext rehydratedContext=internalCallContextFactory.createInternalCallContext(cur.getTenantRecordId(),cur.getAccountRecordId(),context);
    dao.clearBusExtEvent(cur.getId(),hostname,rehydratedContext);
  }
  return result;
}
