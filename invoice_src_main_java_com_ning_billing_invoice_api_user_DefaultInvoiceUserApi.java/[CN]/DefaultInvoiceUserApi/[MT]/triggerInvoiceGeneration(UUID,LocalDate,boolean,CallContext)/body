{
  final Account account;
  try {
    account=accountUserApi.getAccountById(accountId,internalCallContextFactory.createInternalTenantContext(context));
  }
 catch (  AccountApiException e) {
    throw new InvoiceApiException(e,ErrorCode.ACCOUNT_DOES_NOT_EXIST_FOR_ID,e.toString());
  }
  final InternalCallContext internalContext=internalCallContextFactory.createInternalCallContext(accountId,context);
  final DateTime processingDateTime=targetDate.toDateTimeAtCurrentTime(account.getTimeZone());
  final Invoice result=dispatcher.processAccount(accountId,processingDateTime,dryRun,internalContext);
  if (result == null) {
    throw new InvoiceApiException(ErrorCode.INVOICE_NOTHING_TO_DO,accountId,targetDate);
  }
 else {
    return result;
  }
}
