{
  final Account account=createAccountWithDefaultPaymentMethod();
  mockPaymentProviderPlugin.makeNextPaymentFailWithError();
  final PaymentTransaction authTransaction=new PaymentTransaction();
  authTransaction.setAmount(BigDecimal.ONE);
  authTransaction.setCurrency(account.getCurrency());
  authTransaction.setTransactionType(TransactionType.AUTHORIZE.name());
  try {
    killBillClient.createPayment(account.getAccountId(),account.getPaymentMethodId(),authTransaction,ImmutableMap.<String,String>of(),createdBy,reason,comment);
    fail();
  }
 catch (  KillBillClientException e) {
    assertEquals(402,e.getResponse().getStatusCode());
  }
}
