{
  if (baseSubscription.getState() != SubscriptionState.ACTIVE) {
    throw new EntitlementUserApiException(ErrorCode.ENT_CREATE_AO_BP_NON_ACTIVE,targetAddOnPlan.getName());
  }
  Product baseProduct=baseSubscription.getCurrentPlan().getProduct();
  if (addonUtils.isAddonIncluded(baseProduct,targetAddOnPlan)) {
    throw new EntitlementUserApiException(ErrorCode.ENT_CREATE_AO_ALREADY_INCLUDED,targetAddOnPlan.getName(),baseSubscription.getCurrentPlan().getProduct().getName());
  }
  if (!addonUtils.isAddonAvailable(baseProduct,targetAddOnPlan)) {
    throw new EntitlementUserApiException(ErrorCode.ENT_CREATE_AO_NOT_AVAILABLE,targetAddOnPlan.getName(),baseSubscription.getCurrentPlan().getProduct().getName());
  }
}
