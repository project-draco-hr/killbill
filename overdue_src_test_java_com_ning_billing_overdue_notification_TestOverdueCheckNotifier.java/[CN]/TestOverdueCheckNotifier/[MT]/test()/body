{
  final UUID subscriptionId=new UUID(0L,1L);
  final Blockable blockable=BrainDeadProxyFactory.createBrainDeadProxyFor(Subscription.class);
  ((ZombieControl)blockable).addResult("getId",subscriptionId);
  final DateTime now=new DateTime();
  final DateTime readyTime=now.plusMillis(2000);
  final OverdueCheckPoster poster=new DefaultOverdueCheckPoster(notificationQueueService);
  eventBus.start();
  notifier.initialize();
  notifier.start();
  dao.inTransaction(new Transaction<Void,DummySqlTest>(){
    @Override public Void inTransaction(    DummySqlTest transactional,    TransactionStatus status) throws Exception {
      poster.insertOverdueCheckNotification(transactional,blockable,readyTime);
      return null;
    }
  }
);
  ((ClockMock)clock).setDeltaFromReality(3000);
  await().atMost(1,MINUTES).until(new Callable<Boolean>(){
    @Override public Boolean call() throws Exception {
      return listener.getEventCount() == 1;
    }
  }
);
  Assert.assertEquals(listener.getEventCount(),1);
  Assert.assertEquals(listener.getLatestSubscriptionId(),subscriptionId);
}
