{
  this.account=new AccountJson(account,null,null,accountAuditLogs);
  this.bundles=new LinkedList<BundleJson>();
  for (  final SubscriptionBundle bundle : bundles) {
    final BundleJson jsonWithSubscriptions=new BundleJson(bundle,accountAuditLogs);
    this.bundles.add(jsonWithSubscriptions);
  }
  this.invoices=new LinkedList<InvoiceJson>();
  final List<CreditJson> credits=new ArrayList<CreditJson>();
  for (  final Invoice invoice : invoices) {
    for (    final InvoiceItem invoiceItem : invoice.getInvoiceItems()) {
      if (InvoiceItemType.CREDIT_ADJ.equals(invoiceItem.getInvoiceItemType())) {
        final List<AuditLog> auditLogs=accountAuditLogs.getAuditLogsForInvoiceItem(invoiceItem.getId());
        credits.add(new CreditJson(invoice,invoiceItem,auditLogs));
      }
    }
  }
  for (  final Invoice invoice : invoices) {
    final List<AuditLog> auditLogs=accountAuditLogs.getAuditLogsForInvoice(invoice.getId());
    this.invoices.add(new InvoiceJson(invoice,getBundleExternalKey(invoice,bundles),credits,auditLogs));
  }
  this.payments=new LinkedList<PaymentJson>();
  for (  final DirectPayment payment : payments) {
    final List<RefundJson> refunds=new ArrayList<RefundJson>();
    for (    final DirectPaymentTransaction refund : refundsByPayment.get(payment.getId())) {
      final List<AuditLog> auditLogs=accountAuditLogs.getAuditLogsForPaymentTransaction(refund.getId());
      refunds.add(new RefundJson(refund,null,auditLogs));
    }
    final List<ChargebackJson> chargebacks=new ArrayList<ChargebackJson>();
    for (    final DirectPaymentTransaction chargeback : chargebacksByPayment.get(payment.getId())) {
      final List<AuditLog> auditLogs=accountAuditLogs.getAuditLogsForPaymentTransaction(chargeback.getId());
      chargebacks.add(new ChargebackJson(payment.getAccountId(),chargeback,auditLogs));
    }
    final List<AuditLog> auditLogs=accountAuditLogs.getAuditLogsForPayment(payment.getId());
    final UUID invoiceId=invoiceIdByPayment.get(payment.getId());
    this.payments.add(new PaymentJson(payment,getBundleExternalKey(invoiceId,invoices,bundles),refunds,chargebacks,auditLogs));
  }
}
