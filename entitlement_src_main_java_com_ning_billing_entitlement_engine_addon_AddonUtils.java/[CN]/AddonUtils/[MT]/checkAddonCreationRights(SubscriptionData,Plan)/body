{
  if (baseSubscription.getState() != SubscriptionState.ACTIVE) {
    throw new SubscriptionUserApiException(ErrorCode.SUB_CREATE_AO_BP_NON_ACTIVE,targetAddOnPlan.getName());
  }
  final Product baseProduct=baseSubscription.getCurrentPlan().getProduct();
  if (isAddonIncluded(baseProduct,targetAddOnPlan)) {
    throw new SubscriptionUserApiException(ErrorCode.SUB_CREATE_AO_ALREADY_INCLUDED,targetAddOnPlan.getName(),baseSubscription.getCurrentPlan().getProduct().getName());
  }
  if (!isAddonAvailable(baseProduct,targetAddOnPlan)) {
    throw new SubscriptionUserApiException(ErrorCode.SUB_CREATE_AO_NOT_AVAILABLE,targetAddOnPlan.getName(),baseSubscription.getCurrentPlan().getProduct().getName());
  }
}
