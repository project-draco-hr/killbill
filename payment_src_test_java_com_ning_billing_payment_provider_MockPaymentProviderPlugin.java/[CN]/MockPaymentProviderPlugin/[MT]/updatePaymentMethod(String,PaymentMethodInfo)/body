{
  if (paymentMethod != null) {
    PaymentMethodInfo realPaymentMethod=null;
    if (paymentMethod instanceof PaypalPaymentMethodInfo) {
      PaypalPaymentMethodInfo paypalPaymentMethod=(PaypalPaymentMethodInfo)paymentMethod;
      realPaymentMethod=new PaypalPaymentMethodInfo.Builder(paypalPaymentMethod).build();
    }
 else     if (paymentMethod instanceof CreditCardPaymentMethodInfo) {
      CreditCardPaymentMethodInfo ccPaymentMethod=(CreditCardPaymentMethodInfo)paymentMethod;
      realPaymentMethod=new CreditCardPaymentMethodInfo.Builder(ccPaymentMethod).build();
    }
    if (realPaymentMethod == null) {
      throw new PaymentPluginApiException("","Payment method " + paymentMethod.getType() + " not supported by the plugin");
    }
 else {
      paymentMethods.put(paymentMethod.getId(),paymentMethod);
      return realPaymentMethod;
    }
  }
 else {
    throw new PaymentPluginApiException("","Could not create add payment method " + paymentMethod + " for "+ accountKey);
  }
}
