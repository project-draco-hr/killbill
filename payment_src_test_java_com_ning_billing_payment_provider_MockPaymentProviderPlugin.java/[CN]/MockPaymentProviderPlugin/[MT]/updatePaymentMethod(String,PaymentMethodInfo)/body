{
  if (paymentMethod != null) {
    PaymentMethodInfo realPaymentMethod=null;
    if (paymentMethod instanceof PaypalPaymentMethodInfo) {
      PaypalPaymentMethodInfo paypalPaymentMethod=(PaypalPaymentMethodInfo)paymentMethod;
      realPaymentMethod=new PaypalPaymentMethodInfo.Builder(paypalPaymentMethod).build();
    }
 else     if (paymentMethod instanceof CreditCardPaymentMethodInfo) {
      CreditCardPaymentMethodInfo ccPaymentMethod=(CreditCardPaymentMethodInfo)paymentMethod;
      realPaymentMethod=new CreditCardPaymentMethodInfo.Builder(ccPaymentMethod).build();
    }
    if (realPaymentMethod == null) {
      return Either.left((PaymentError)new DefaultPaymentError("unsupported","Payment method " + paymentMethod.getType() + " not supported by the plugin",null,null,null));
    }
 else {
      paymentMethods.put(paymentMethod.getId(),paymentMethod);
      return Either.right(realPaymentMethod);
    }
  }
 else {
    return Either.left((PaymentError)new DefaultPaymentError("unknown","Could not create add payment method " + paymentMethod + " for "+ accountKey,null,null,null));
  }
}
