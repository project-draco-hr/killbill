{
  Set<UUID> result=new LinkedHashSet<UUID>();
synchronized (monitor) {
    for (    InvoicePayment invoicePayment : invoicePayments.values()) {
      Invoice invoice=invoices.get(invoicePayment.getInvoiceId());
      if ((invoice != null) && (((invoicePayment.getPaymentAttemptDate() == null) || !invoicePayment.getPaymentAttemptDate().plusDays(numberOfDays).isAfter(targetDate.getTime())) && (invoice.getTotalAmount() != null) && invoice.getTotalAmount().doubleValue() >= 0) && ((invoicePayment.getAmount() == null) || invoicePayment.getAmount().doubleValue() >= invoice.getTotalAmount().doubleValue())) {
        result.add(invoice.getId());
      }
    }
  }
  return new ArrayList<UUID>(result);
}
