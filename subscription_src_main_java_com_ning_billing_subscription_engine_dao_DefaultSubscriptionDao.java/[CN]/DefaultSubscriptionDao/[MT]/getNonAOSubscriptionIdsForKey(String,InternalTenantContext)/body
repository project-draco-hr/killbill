{
  return transactionalSqlDao.execute(new EntitySqlDaoTransactionWrapper<Iterable<UUID>>(){
    @Override public Iterable<UUID> inTransaction(    final EntitySqlDaoWrapperFactory<EntitySqlDao> entitySqlDaoWrapperFactory) throws Exception {
      final BundleSqlDao bundleSqlDao=entitySqlDaoWrapperFactory.become(BundleSqlDao.class);
      final List<SubscriptionBundleModelDao> bundles=bundleSqlDao.getBundlesForKey(bundleKey,context);
      Iterable<UUID> result=Collections.emptyList();
      final SubscriptionSqlDao subscriptionSqlDao=entitySqlDaoWrapperFactory.become(SubscriptionSqlDao.class);
      for (      SubscriptionBundleModelDao cur : bundles) {
        final List<SubscriptionModelDao> subscriptions=subscriptionSqlDao.getSubscriptionsFromBundleId(cur.getId().toString(),context);
        final Iterable nonAddonSubscriptions=Iterables.filter(subscriptions,new Predicate<SubscriptionModelDao>(){
          @Override public boolean apply(          final SubscriptionModelDao input){
            return input.getCategory() != ProductCategory.ADD_ON;
          }
        }
);
        final Iterable nonAddonSubscriptionIds=Iterables.transform(nonAddonSubscriptions,new Function<SubscriptionModelDao,UUID>(){
          @Override public UUID apply(          @Nullable final SubscriptionModelDao input){
            return input.getId();
          }
        }
);
        result=Iterables.concat(result,nonAddonSubscriptionIds);
      }
      return result;
    }
  }
);
}
