{
  final String productName="Shotgun";
  final BillingPeriod term=BillingPeriod.MONTHLY;
  final String planSetName=PriceListSet.DEFAULT_PRICELIST_NAME;
  final PlanPhaseSpecifier phaseSpecifier=new PlanPhaseSpecifier(productName,ProductCategory.BASE,term,planSetName,null);
  final Subscription subscription=entitlementUserApi.createSubscription(bundle.getId(),phaseSpecifier,null,context);
  waitALittle();
  final List<BusinessSubscriptionTransition> transitions=analyticsUserApi.getTransitionsForBundle(bundle.getKey());
  Assert.assertEquals(transitions.size(),1);
  final BusinessSubscriptionTransition transition=transitions.get(0);
  Assert.assertEquals(transition.getExternalKey(),bundle.getKey());
  Assert.assertEquals(transition.getAccountKey(),account.getExternalKey());
  Assert.assertEquals(transition.getEvent().getCategory(),phaseSpecifier.getProductCategory());
  Assert.assertEquals(transition.getEvent().getEventType(),BusinessSubscriptionEvent.EventType.ADD);
  Assert.assertNull(transition.getPreviousSubscription());
  Assert.assertEquals(transition.getNextSubscription().getBillingPeriod(),subscription.getCurrentPhase().getBillingPeriod().toString());
  Assert.assertEquals(transition.getNextSubscription().getBundleId(),subscription.getBundleId());
  Assert.assertEquals(transition.getNextSubscription().getCurrency(),account.getCurrency().toString());
  Assert.assertEquals(transition.getNextSubscription().getPhase(),subscription.getCurrentPhase().getPhaseType().toString());
  Assert.assertEquals(transition.getNextSubscription().getPrice().doubleValue(),subscription.getCurrentPhase().getFixedPrice().getPrice(account.getCurrency()).doubleValue());
  Assert.assertEquals(transition.getNextSubscription().getPriceList(),subscription.getCurrentPriceList().getName());
  Assert.assertEquals(transition.getNextSubscription().getProductCategory(),subscription.getCurrentPlan().getProduct().getCategory());
  Assert.assertEquals(transition.getNextSubscription().getProductName(),subscription.getCurrentPlan().getProduct().getName());
  Assert.assertEquals(transition.getNextSubscription().getProductType(),subscription.getCurrentPlan().getProduct().getCatalogName());
  Assert.assertEquals(transition.getNextSubscription().getSlug(),subscription.getCurrentPhase().getName());
  Assert.assertEquals(transition.getNextSubscription().getStartDate(),subscription.getStartDate());
  Assert.assertEquals(transition.getNextSubscription().getState(),subscription.getState());
  Assert.assertEquals(transition.getNextSubscription().getSubscriptionId(),subscription.getId());
  final BusinessAccount businessAccount=analyticsUserApi.getAccountByKey(account.getExternalKey());
  Assert.assertEquals(businessAccount.getBalance().doubleValue(),Rounder.round(BigDecimal.ZERO));
  Assert.assertEquals(businessAccount.getTotalInvoiceBalance().doubleValue(),Rounder.round(BigDecimal.ZERO));
  return subscription;
}
