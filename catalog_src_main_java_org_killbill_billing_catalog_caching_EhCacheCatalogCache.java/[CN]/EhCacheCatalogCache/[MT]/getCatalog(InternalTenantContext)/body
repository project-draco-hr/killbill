{
  if (tenantContext.getTenantRecordId() == InternalCallContextFactory.INTERNAL_TENANT_RECORD_ID) {
    if (defaultCatalog == null) {
      throw new CatalogApiException(ErrorCode.CAT_INVALID_DEFAULT,"the system property org.killbill.catalog.uri must be specified and point to valid catalog xml");
    }
    return defaultCatalog;
  }
  try {
    VersionedCatalog tenantCatalog=(VersionedCatalog)cacheController.get(tenantContext.getTenantRecordId(),cacheLoaderArgument);
    if (tenantCatalog == null) {
      tenantCatalog=new VersionedCatalog(defaultCatalog,tenantContext);
      cacheController.add(tenantContext.getTenantRecordId(),tenantCatalog);
    }
    return tenantCatalog;
  }
 catch (  final IllegalStateException e) {
    throw new CatalogApiException(ErrorCode.CAT_INVALID_FOR_TENANT,tenantContext.getTenantRecordId());
  }
}
