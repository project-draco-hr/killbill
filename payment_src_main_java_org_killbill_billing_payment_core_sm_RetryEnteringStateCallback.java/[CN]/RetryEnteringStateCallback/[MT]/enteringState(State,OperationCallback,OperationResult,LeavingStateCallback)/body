{
  final PaymentAttemptModelDao attempt=retryableDirectPaymentAutomatonRunner.paymentDao.getPaymentAttempt(directPaymentStateContext.getAttemptId(),directPaymentStateContext.internalCallContext);
  final UUID transactionId=directPaymentStateContext.getCurrentTransaction() != null ? directPaymentStateContext.getCurrentTransaction().getId() : null;
  retryableDirectPaymentAutomatonRunner.paymentDao.updatePaymentAttempt(attempt.getId(),transactionId,state.getName(),directPaymentStateContext.internalCallContext);
  if ("RETRIED".equals(state.getName())) {
    retryServiceScheduler.scheduleRetry(ObjectType.PAYMENT_ATTEMPT,attempt.getId(),directPaymentStateContext.directPaymentTransactionExternalKey,directPaymentStateContext.getPluginName(),directPaymentStateContext.getRetryDate());
  }
}
