{
  final PaymentAttemptModelDao attempt=retryablePaymentAutomatonRunner.paymentDao.getPaymentAttempt(paymentStateContext.getAttemptId(),paymentStateContext.internalCallContext);
  final UUID transactionId=paymentStateContext.getCurrentTransaction() != null ? paymentStateContext.getCurrentTransaction().getId() : null;
  retryablePaymentAutomatonRunner.paymentDao.updatePaymentAttempt(attempt.getId(),transactionId,state.getName(),paymentStateContext.internalCallContext);
  if ("RETRIED".equals(state.getName())) {
    retryServiceScheduler.scheduleRetry(ObjectType.PAYMENT_ATTEMPT,attempt.getId(),attempt.getId(),attempt.getTenantRecordId(),paymentStateContext.getPaymentControlPluginNames(),paymentStateContext.getRetryDate());
  }
}
