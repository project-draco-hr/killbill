{
  InputStream is=null;
  TarArchiveInputStream archiveInputStream=null;
  TarArchiveEntry entry=null;
  try {
    is=new FileInputStream(inputFile);
    archiveInputStream=(TarArchiveInputStream)new ArchiveStreamFactory().createArchiveInputStream("tar",is);
    while ((entry=(TarArchiveEntry)archiveInputStream.getNextEntry()) != null) {
      final File outputFile=new File(outputDir,entry.getName());
      if (entry.isDirectory()) {
        if (!outputFile.exists()) {
          if (!outputFile.mkdirs()) {
            throw new IllegalStateException(String.format("Couldn't create directory %s.",outputFile.getAbsolutePath()));
          }
        }
      }
 else {
        final OutputStream outputFileStream=new FileOutputStream(outputFile);
        ByteStreams.copy(archiveInputStream,outputFileStream);
        outputFileStream.close();
      }
    }
  }
  finally {
    if (archiveInputStream != null) {
      archiveInputStream.close();
    }
    if (is != null) {
      is.close();
    }
  }
}
