{
  final PaymentPluginApi api=getTestPluginPaymentApi();
  account=createAccountWithNonOsgiPaymentMethod(getAccountData(4));
  final DateTime beforeCall=new DateTime().toDateTime(DateTimeZone.UTC).minusSeconds(1);
  final PaymentInfoPlugin res=api.processPayment(account.getId(),UUID.randomUUID(),UUID.randomUUID(),BigDecimal.TEN,Currency.USD,ImmutableList.<PluginProperty>of(),callContext);
  final DateTime afterCall=new DateTime().toDateTime(DateTimeZone.UTC).plusSeconds(1);
  Assert.assertTrue(res.getAmount().compareTo(BigDecimal.TEN) == 0);
  Assert.assertTrue(res.getCreatedDate().compareTo(beforeCall) >= 0);
  Assert.assertTrue(res.getCreatedDate().compareTo(afterCall) <= 0);
  Assert.assertTrue(res.getEffectiveDate().compareTo(beforeCall) >= 0);
  Assert.assertTrue(res.getEffectiveDate().compareTo(afterCall) <= 0);
  assertEquals(res.getGatewayError(),"gateway_error");
  assertEquals(res.getGatewayErrorCode(),"gateway_error_code");
  assertEquals(res.getStatus(),PaymentPluginStatus.PROCESSED);
}
