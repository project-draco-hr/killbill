{
  final UUID paymentId=UUID.randomUUID();
  setUp(paymentId);
  final List<PaymentTransactionModelDao> transactions=paymentDao.getTransactionsForPayment(paymentId,internalCallContext);
  Assert.assertEquals(transactions.size(),1);
  final String paymentStateName=paymentSMHelper.getErroredStateForTransaction(TransactionType.CAPTURE).toString();
  paymentDao.updatePaymentAndTransactionOnCompletion(account.getId(),transactions.get(0).getAttemptId(),paymentId,TransactionType.AUTHORIZE,paymentStateName,paymentStateName,transactions.get(0).getId(),TransactionStatus.SUCCESS,BigDecimal.ONE,Currency.BRL,"foo","bar",internalCallContext);
  callback.leavingState(state);
}
