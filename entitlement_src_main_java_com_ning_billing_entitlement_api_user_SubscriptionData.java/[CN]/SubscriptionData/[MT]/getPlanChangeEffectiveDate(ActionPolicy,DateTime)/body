{
  if (policy == ActionPolicy.IMMEDIATE) {
    return now;
  }
  if (policy != ActionPolicy.END_OF_TERM) {
    throw new EntitlementError(String.format("Unexpected policy type %s",policy.toString()));
  }
  DateTime effectiveDate=chargedThroughDate;
  if (chargedThroughDate == null || chargedThroughDate.isBefore(clock.getUTCNow())) {
    effectiveDate=getCurrentPhaseStart();
  }
  return effectiveDate;
}
