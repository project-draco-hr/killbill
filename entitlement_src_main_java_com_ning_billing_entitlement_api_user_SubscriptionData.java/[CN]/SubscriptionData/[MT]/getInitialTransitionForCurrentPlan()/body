{
  if (transitions == null) {
    throw new EntitlementError(String.format("No transitions for subscription %s",getId()));
  }
  Iterator<SubscriptionTransitionData> it=((LinkedList<SubscriptionTransitionData>)transitions).descendingIterator();
  while (it.hasNext()) {
    SubscriptionTransitionData cur=it.next();
    if (cur.getEffectiveTransitionTime().isAfter(clock.getUTCNow())) {
      continue;
    }
    if (cur.getTransitionType() == SubscriptionTransitionType.MIGRATE_BILLING) {
      continue;
    }
    if (cur.getEventType() == EventType.API_USER && (cur.getApiEventType() == ApiEventType.CHANGE || cur.getApiEventType() == ApiEventType.RE_CREATE)) {
      return cur;
    }
  }
  return transitions.get(0);
}
