{
  try {
    final Subscription subscription=subscriptionApi.getSubscriptionFromId(subscriptionId,context);
    if (expectedLocalCTD == null) {
      assertNull(subscription.getChargedThroughDate());
    }
 else {
      final DateTime expectedCTD=expectedLocalCTD.toDateTime(new LocalTime(subscription.getStartDate().getMillis(),DateTimeZone.UTC),DateTimeZone.UTC);
      final String msg=String.format("Checking CTD for subscription %s : expectedLocalCTD = %s => expectedCTD = %s, got %s",subscriptionId,expectedLocalCTD,expectedCTD,subscription.getChargedThroughDate());
      log.info(msg);
      assertNotNull(subscription.getChargedThroughDate());
      assertTrue(subscription.getChargedThroughDate().compareTo(expectedCTD) == 0,msg);
    }
  }
 catch (  SubscriptionUserApiException e) {
    fail("Failed to retrieve subscription for " + subscriptionId);
  }
}
