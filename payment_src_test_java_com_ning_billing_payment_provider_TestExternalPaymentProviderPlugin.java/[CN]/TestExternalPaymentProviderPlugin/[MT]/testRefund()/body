{
  final String externalKey=UUID.randomUUID().toString();
  final UUID paymentId=UUID.randomUUID();
  final BigDecimal amount=BigDecimal.TEN;
  plugin.processPayment(externalKey,paymentId,amount,callContext);
  plugin.processRefund(Mockito.mock(Account.class),paymentId,BigDecimal.ONE,callContext);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),UUID.randomUUID(),BigDecimal.ONE,callContext),0);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,BigDecimal.TEN,callContext),0);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,BigDecimal.ONE,callContext),1);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,new BigDecimal("5"),callContext),0);
  plugin.processRefund(Mockito.mock(Account.class),paymentId,BigDecimal.ONE,callContext);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),UUID.randomUUID(),BigDecimal.ONE,callContext),0);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,BigDecimal.TEN,callContext),0);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,BigDecimal.ONE,callContext),2);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,new BigDecimal("5"),callContext),0);
  plugin.processRefund(Mockito.mock(Account.class),paymentId,BigDecimal.ONE,callContext);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),UUID.randomUUID(),BigDecimal.ONE,callContext),0);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,BigDecimal.TEN,callContext),0);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,BigDecimal.ONE,callContext),3);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,new BigDecimal("5"),callContext),0);
  plugin.processRefund(Mockito.mock(Account.class),paymentId,new BigDecimal("5"),callContext);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),UUID.randomUUID(),BigDecimal.ONE,callContext),0);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,BigDecimal.TEN,callContext),0);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,BigDecimal.ONE,callContext),3);
  Assert.assertEquals(plugin.getNbRefundForPaymentAmount(Mockito.mock(Account.class),paymentId,new BigDecimal("5"),callContext),1);
}
