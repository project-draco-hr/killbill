{
  UUID accountId=UUID.randomUUID();
  Subscription subscription=new MockSubscription();
  Plan plan1=new MockPlan("plan 1");
  PlanPhase phase1=new MockPlanPhase(plan1,PhaseType.TRIAL);
  Plan plan2=new MockPlan("plan 2");
  PlanPhase phase2=new MockPlanPhase(plan2,PhaseType.TRIAL);
  InternationalPrice zeroPrice=new MockInternationalPrice(new DefaultPrice(ZERO,Currency.USD));
  BillingEventSet events=new BillingEventSet();
  BillingEvent event1=new DefaultBillingEvent(subscription,new DateTime("2012-01-31T00:02:04.000Z"),plan1,phase1,zeroPrice,null,BillingPeriod.NO_BILLING_PERIOD,1,BillingModeType.IN_ADVANCE,"Test Event 1");
  events.add(event1);
  Invoice invoice1=generator.generateInvoice(accountId,events,null,new DateTime("2012-01-31T00:02:04.000Z"),Currency.USD);
  assertNotNull(invoice1);
  assertEquals(invoice1.getNumberOfItems(),1);
  BillingEvent event2=new DefaultBillingEvent(subscription,new DateTime("2012-01-31T00:02:04.000Z"),plan2,phase2,zeroPrice,null,BillingPeriod.NO_BILLING_PERIOD,1,BillingModeType.IN_ADVANCE,"Test Event 2");
  events.add(event2);
  InvoiceItemList items=new InvoiceItemList(invoice1.getInvoiceItems());
  Invoice invoice2=generator.generateInvoice(accountId,events,items,new DateTime("2012-01-31T00:02:04.000Z"),Currency.USD);
  assertNotNull(invoice2);
  assertEquals(invoice2.getNumberOfItems(),1);
  assertEquals(invoice2.getInvoiceItems().get(0).getPlanName(),plan2.getName());
}
