{
  for (  final TimelineChunk chunk : chunksForSourceAndMetric) {
    final String source=timelineDao.getSource(chunk.getSourceId(),context);
    final CategoryRecordIdAndMetric categoryIdAndMetric=timelineDao.getCategoryIdAndMetric(chunk.getMetricId(),context);
    final String eventCategory=timelineDao.getEventCategory(categoryIdAndMetric.getEventCategoryId(),context);
    final String metric=categoryIdAndMetric.getMetric();
    final TimeRangeSampleProcessor filter=filters.get(chunk.getSourceId()).get(chunk.getMetricId());
    final String samples=filter == null ? CSVConsumer.getSamplesAsCSV(sampleCoder,chunk) : CSVConsumer.getSamplesAsCSV(sampleCoder,chunk,filter);
    if (!Strings.isNullOrEmpty(samples)) {
      generator.writeObject(new SamplesForMetricAndSource(source,eventCategory,metric,samples));
    }
  }
}
