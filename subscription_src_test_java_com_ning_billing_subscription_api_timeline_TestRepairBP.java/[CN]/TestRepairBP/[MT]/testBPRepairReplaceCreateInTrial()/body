{
  final String baseProduct="Shotgun";
  final String newBaseProduct="Assault-Rifle";
  final DateTime startDate=clock.getUTCNow();
  final int clockShift=10;
  final DateTime restartDate=startDate.plusDays(clockShift).minusDays(1);
  final LinkedList<ExistingEvent> expected=new LinkedList<SubscriptionBaseTimeline.ExistingEvent>();
  expected.add(testUtil.createExistingEventForAssertion(SubscriptionBaseTransitionType.CREATE,newBaseProduct,PhaseType.TRIAL,ProductCategory.BASE,PriceListSet.DEFAULT_PRICELIST_NAME,BillingPeriod.NO_BILLING_PERIOD,restartDate));
  expected.add(testUtil.createExistingEventForAssertion(SubscriptionBaseTransitionType.PHASE,newBaseProduct,PhaseType.EVERGREEN,ProductCategory.BASE,PriceListSet.DEFAULT_PRICELIST_NAME,BillingPeriod.MONTHLY,restartDate.plusDays(30)));
  final UUID baseSubscriptionId=testBPRepairCreate(true,startDate,clockShift,baseProduct,newBaseProduct,expected);
  testListener.pushExpectedEvent(NextEvent.PHASE);
  final Interval it=new Interval(clock.getUTCNow(),clock.getUTCNow().plusDays(32));
  clock.addDeltaFromReality(it.toDurationMillis());
  assertListenerStatus();
  final DefaultSubscriptionBase subscription=(DefaultSubscriptionBase)subscriptionInternalApi.getSubscriptionFromId(baseSubscriptionId,internalCallContext);
  assertEquals(subscription.getActiveVersion(),SubscriptionEvents.INITIAL_VERSION + 1);
  assertEquals(subscription.getBundleId(),bundle.getId());
  assertEquals(subscription.getStartDate(),restartDate);
  assertEquals(subscription.getBundleStartDate(),restartDate);
  final Plan currentPlan=subscription.getCurrentPlan();
  assertNotNull(currentPlan);
  assertEquals(currentPlan.getProduct().getName(),newBaseProduct);
  assertEquals(currentPlan.getProduct().getCategory(),ProductCategory.BASE);
  assertEquals(currentPlan.getBillingPeriod(),BillingPeriod.MONTHLY);
  final PlanPhase currentPhase=subscription.getCurrentPhase();
  assertNotNull(currentPhase);
  assertEquals(currentPhase.getPhaseType(),PhaseType.EVERGREEN);
  assertListenerStatus();
}
