{
  DateTime now=clock.getUTCNow();
  DateTime then=now.minusDays(1);
  Plan nextPlan=catalogService.getFullCatalog().findPlan("laser-scope-monthly",now);
  PlanPhase nextPhase=nextPlan.getAllPhases()[0];
  PriceList nextPriceList=catalogService.getFullCatalog().findPriceList(PriceListSet.DEFAULT_PRICELIST_NAME,now);
  SubscriptionTransition t=new SubscriptionTransitionData(zeroId,oneId,twoId,EventType.API_USER,ApiEventType.CREATE,then,now,null,null,null,null,SubscriptionState.ACTIVE,nextPlan,nextPhase,nextPriceList,1,true);
  transitions.add(t);
  Account account=BrainDeadProxyFactory.createBrainDeadProxyFor(Account.class);
  ((ZombieControl)account).addResult("getBillCycleDay",1).addResult("getTimeZone",DateTimeZone.UTC);
  ((ZombieControl)account).addResult("getCurrency",Currency.USD);
  AccountUserApi accountApi=BrainDeadProxyFactory.createBrainDeadProxyFor(AccountUserApi.class);
  ((ZombieControl)accountApi).addResult("getAccountById",account);
  EntitlementUserApi entitlementApi=BrainDeadProxyFactory.createBrainDeadProxyFor(EntitlementUserApi.class);
  ((ZombieControl)entitlementApi).addResult("getBaseSubscription",subscription);
  BillCycleDayCalculator bcdCalculator=new BillCycleDayCalculator(catalogService,entitlementApi);
  CallContextFactory factory=new DefaultCallContextFactory(clock);
  DefaultEntitlementBillingApi api=new DefaultEntitlementBillingApi(factory,null,dao,accountApi,bcdCalculator);
  SortedSet<BillingEvent> events=api.getBillingEventsForAccountAndUpdateAccountBCD(new UUID(0L,0L));
  checkFirstEvent(events,nextPlan,subscription.getStartDate().plusDays(30).getDayOfMonth(),oneId,now,nextPhase,ApiEventType.CREATE.toString());
}
