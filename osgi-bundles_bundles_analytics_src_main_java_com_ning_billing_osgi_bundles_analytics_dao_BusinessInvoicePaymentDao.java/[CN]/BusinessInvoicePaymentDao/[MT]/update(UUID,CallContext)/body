{
  final Account account=getAccount(accountId,context);
  final BusinessAccountModelDao bac=businessAccountDao.createBusinessAccount(account,context);
  final Collection<BusinessInvoicePaymentBaseModelDao> businessInvoicePayments=createBusinessInvoicePayments(account,context);
  final Map<BusinessInvoiceModelDao,Collection<BusinessInvoiceItemBaseModelDao>> businessInvoices=businessInvoiceDao.createBusinessInvoicesAndInvoiceItems(account,context);
  sqlDao.inTransaction(new Transaction<Void,BusinessAnalyticsSqlDao>(){
    @Override public Void inTransaction(    final BusinessAnalyticsSqlDao transactional,    final TransactionStatus status) throws Exception {
      updateInTransaction(bac,businessInvoices,businessInvoicePayments,transactional,context);
      return null;
    }
  }
);
}
