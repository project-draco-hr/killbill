{
  final UUID accountId=UUID.randomUUID();
  final LocalDate targetDate1=new LocalDate(2011,10,6);
  final Invoice invoice1=new DefaultInvoice(accountId,clock.getUTCToday(),targetDate1,Currency.USD);
  invoiceDao.create(invoice1,invoice1.getTargetDate().getDayOfMonth(),true,internalCallContext);
  final BigDecimal payment1=new BigDecimal("48.0");
  final InvoicePayment payment=new DefaultInvoicePayment(InvoicePaymentType.ATTEMPT,UUID.randomUUID(),invoice1.getId(),new DateTime(),payment1,Currency.USD);
  invoicePaymentDao.create(payment,internalCallContext);
  final BigDecimal balance=invoiceDao.getAccountBalance(accountId,internalCallContext);
  assertEquals(balance.compareTo(BigDecimal.ZERO.subtract(payment1)),0);
}
