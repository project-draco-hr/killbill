{
  GlobalLock lock=null;
  try {
    lock=locker.lockWithNumberOfTries(LockerService.INVOICE,accountId.toString(),NB_LOCK_TRY);
    return processAccountWithLock(accountId,targetDate,dryRun,context);
  }
 catch (  LockFailedException e) {
    log.error(String.format("Failed to process invoice for account %s, targetDate %s",accountId.toString(),targetDate),e);
  }
 finally {
    if (lock != null) {
      lock.release();
    }
  }
  return null;
}
