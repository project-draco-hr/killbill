{
  final Integer result=delegate.inTransaction(new Transaction<Integer,TimelineSqlDao>(){
    @Override public Integer inTransaction(    final TimelineSqlDao transactional,    final TransactionStatus status) throws Exception {
      return getOrAddWithRetry(new Callable<Integer>(){
        @Override public Integer call() throws Exception {
          Integer eventCategoryId=transactional.getCategoryRecordId(eventCategory,context);
          if (eventCategoryId == null) {
            transactional.addCategory(eventCategory,context);
            eventCategoryId=transactional.getCategoryRecordId(eventCategory,context);
          }
          return eventCategoryId;
        }
      }
);
    }
  }
);
  return result;
}
