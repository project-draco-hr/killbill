{
  return doCallAndCheckForCompletion(new Function<Void,Subscription>(){
    @Override public Subscription apply(    @Nullable final Void dontcare){
      try {
        final Subscription refreshedSubscription=entitlementUserApi.getSubscriptionFromId(subscription.getId(),callContext);
        refreshedSubscription.changePlan(productName,billingPeriod,PriceListSet.DEFAULT_PRICELIST_NAME,clock.getUTCNow(),callContext);
        return refreshedSubscription;
      }
 catch (      SubscriptionUserApiException e) {
        fail(e.getMessage());
        return null;
      }
    }
  }
,events);
}
