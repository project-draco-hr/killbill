{
  final AuditLog creationAuditLog=getAccountCreationAuditLog(account.getId(),context);
  final BigDecimal accountBalance=getAccountBalance(account.getId(),context);
  Invoice lastInvoice=null;
  final Collection<Invoice> invoices=getInvoicesByAccountId(account.getId(),context);
  for (  final Invoice invoice : invoices) {
    if (lastInvoice == null || invoice.getInvoiceDate().isAfter(lastInvoice.getInvoiceDate())) {
      lastInvoice=invoice;
    }
  }
  Payment lastPayment=null;
  final Collection<Payment> payments=getPaymentsByAccountId(account.getId(),context);
  for (  final Payment payment : payments) {
    if (lastPayment == null || payment.getEffectiveDate().isAfter(lastPayment.getEffectiveDate())) {
      lastPayment=payment;
    }
  }
  final List<SubscriptionBundle> bundles=getSubscriptionBundlesForAccount(account.getId(),context);
  int nbActiveBundles=0;
  for (  final SubscriptionBundle bundle : bundles) {
    final Collection<Subscription> subscriptionsForBundle=getSubscriptionsForBundle(bundle.getId(),context);
    for (    final Subscription subscription : subscriptionsForBundle) {
      if (ProductCategory.BASE.equals(subscription.getCategory()) && !(subscription.getEndDate() != null && !subscription.getEndDate().isAfterNow())) {
        nbActiveBundles++;
      }
    }
  }
  final Long accountRecordId=getAccountRecordId(account.getId(),context);
  final Long tenantRecordId=getTenantRecordId(context);
  final ReportGroup reportGroup=getReportGroup(account.getId(),context);
  return new BusinessAccountModelDao(account,accountRecordId,accountBalance,lastInvoice,lastPayment,nbActiveBundles,creationAuditLog,tenantRecordId,reportGroup);
}
