{
  UUID accountId=UUID.randomUUID();
  UUID invoiceId=UUID.randomUUID();
  BigDecimal amount=new BigDecimal(13);
  Currency currency=Currency.USD;
  DateTime effectiveDate=clock.getUTCNow();
  PaymentModelDao payment=new PaymentModelDao(accountId,invoiceId,amount,currency,effectiveDate);
  PaymentAttemptModelDao attempt=new PaymentAttemptModelDao(accountId,invoiceId,payment.getId(),clock.getUTCNow(),amount);
  PaymentModelDao savedPayment=paymentDao.insertPaymentWithAttempt(payment,attempt,true,context);
  assertEquals(savedPayment.getId(),payment.getId());
  assertEquals(savedPayment.getAccountId(),accountId);
  assertEquals(savedPayment.getInvoiceId(),invoiceId);
  assertEquals(savedPayment.getPaymentMethodId(),null);
  assertEquals(savedPayment.getAmount().compareTo(amount),0);
  assertEquals(savedPayment.getCurrency(),currency);
  assertEquals(savedPayment.getEffectiveDate().compareTo(effectiveDate),0);
  assertEquals(savedPayment.getPaymentStatus(),PaymentStatus.UNKNOWN);
  PaymentAttemptModelDao savedAttempt=paymentDao.getPaymentAttempt(attempt.getId());
  assertEquals(savedAttempt.getId(),attempt.getId());
  assertEquals(savedAttempt.getPaymentId(),payment.getId());
  assertEquals(savedAttempt.getAccountId(),accountId);
  assertEquals(savedAttempt.getInvoiceId(),invoiceId);
  assertEquals(savedAttempt.getPaymentStatus(),PaymentStatus.UNKNOWN);
  List<PaymentModelDao> payments=paymentDao.getPaymentsForInvoice(invoiceId);
  assertEquals(payments.size(),1);
  savedPayment=payments.get(0);
  assertEquals(savedPayment.getId(),payment.getId());
  assertEquals(savedPayment.getAccountId(),accountId);
  assertEquals(savedPayment.getInvoiceId(),invoiceId);
  assertEquals(savedPayment.getPaymentMethodId(),null);
  assertEquals(savedPayment.getAmount().compareTo(amount),0);
  assertEquals(savedPayment.getCurrency(),currency);
  assertEquals(savedPayment.getEffectiveDate().compareTo(effectiveDate),0);
  assertEquals(savedPayment.getPaymentStatus(),PaymentStatus.UNKNOWN);
  List<PaymentAttemptModelDao> attempts=paymentDao.getAttemptsForPayment(payment.getId());
  assertEquals(attempts.size(),1);
  savedAttempt=attempts.get(0);
  assertEquals(savedAttempt.getId(),attempt.getId());
  assertEquals(savedAttempt.getPaymentId(),payment.getId());
  assertEquals(savedAttempt.getAccountId(),accountId);
  assertEquals(savedAttempt.getInvoiceId(),invoiceId);
  assertEquals(savedAttempt.getPaymentStatus(),PaymentStatus.UNKNOWN);
}
