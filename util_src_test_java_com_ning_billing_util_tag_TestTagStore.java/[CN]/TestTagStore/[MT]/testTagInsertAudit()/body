{
  UUID accountId=UUID.randomUUID();
  TagStore tagStore=new DefaultTagStore(accountId,Account.ObjectType);
  Tag tag=new DescriptiveTag(testTag);
  tagStore.add(tag);
  tagDao.saveTagsFromTransaction(dao,accountId,Account.ObjectType,tagStore.getEntityList(),context);
  List<Tag> savedTags=tagDao.loadTags(accountId,Account.ObjectType);
  assertEquals(savedTags.size(),1);
  Tag savedTag=savedTags.get(0);
  assertEquals(savedTag.getTagDefinitionName(),tag.getTagDefinitionName());
  assertEquals(savedTag.getId(),tag.getId());
  Handle handle=dbi.open();
  String query=String.format("select * from audit_log a inner join tag_history th on a.record_id = th.history_record_id where a.table_name = 'tag_history' and th.id='%s' and a.change_type='INSERT'",tag.getId().toString());
  List<Map<String,Object>> result=handle.select(query);
  assertNotNull(result);
  assertEquals(result.size(),1);
  assertEquals(result.get(0).get("change_type"),"INSERT");
  assertNotNull(result.get(0).get("change_date"));
  DateTime changeDate=new DateTime(result.get(0).get("change_date"));
  assertTrue(Seconds.secondsBetween(changeDate,context.getCreatedDate()).getSeconds() < 2);
  assertEquals(result.get(0).get("changed_by"),context.getUserName());
}
