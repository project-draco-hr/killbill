{
  for (  InvoiceItem invoiceItem : invoiceItems) {
    if (invoiceItem.getEndDate() != null) {
      log.info("Setting CTD for invoice item {} to {}",invoiceItem.getId().toString(),invoiceItem.getEndDate().toString());
      entitlementBillingApi.setChargedThroughDateFromTransaction(dao,invoiceItem.getSubscriptionId(),invoiceItem.getEndDate());
    }
  }
}
