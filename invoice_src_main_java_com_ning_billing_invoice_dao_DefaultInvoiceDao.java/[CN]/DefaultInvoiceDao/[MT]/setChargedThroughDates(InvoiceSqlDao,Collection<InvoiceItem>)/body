{
  for (  InvoiceItem item : invoiceItems) {
    if ((item.getEndDate() != null) && (item.getRecurringAmount() == null || item.getRecurringAmount().compareTo(BigDecimal.ZERO) >= 0)) {
      log.info("Setting CTD for invoice item {} to {}",item.getId().toString(),item.getEndDate().toString());
      entitlementBillingApi.setChargedThroughDateFromTransaction(dao,item.getSubscriptionId(),item.getEndDate());
    }
  }
}
