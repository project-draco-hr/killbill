{
  final Builder<UUID,BigDecimal> invoiceItemIdsWithAmountsBuilder=new Builder<UUID,BigDecimal>();
  if (invoiceItemIdsWithNullAmounts.size() == 0) {
    return invoiceItemIdsWithAmountsBuilder.build();
  }
  final Invoice invoice=transInvoiceDao.getById(invoiceId);
  if (invoice != null) {
    populateChildren(invoice,transInvoiceDao);
  }
 else {
    throw new IllegalStateException("Invoice shouldn't be null for id " + invoiceId);
  }
  for (  final UUID invoiceItemId : invoiceItemIdsWithNullAmounts.keySet()) {
    final BigDecimal adjAmount=Objects.firstNonNull(invoiceItemIdsWithNullAmounts.get(invoiceItemId),getInvoiceItemAmountForId(invoice,invoiceItemId));
    invoiceItemIdsWithAmountsBuilder.put(invoiceItemId,adjAmount);
  }
  return invoiceItemIdsWithAmountsBuilder.build();
}
