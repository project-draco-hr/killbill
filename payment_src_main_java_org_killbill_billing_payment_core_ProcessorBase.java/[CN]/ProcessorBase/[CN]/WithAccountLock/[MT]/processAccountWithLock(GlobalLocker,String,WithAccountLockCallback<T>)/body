{
  GlobalLock lock=null;
  try {
    lock=locker.lockWithNumberOfTries(LockerType.ACCOUNT_FOR_INVOICE_PAYMENTS.toString(),accountExternalKey,NB_LOCK_TRY);
    return callback.doOperation();
  }
 catch (  LockFailedException e) {
    final String format=String.format("Failed to lock account %s",accountExternalKey);
    log.error(String.format(format),e);
    throw new PaymentApiException(ErrorCode.PAYMENT_INTERNAL_ERROR,format);
  }
 finally {
    if (lock != null) {
      lock.release();
    }
  }
}
