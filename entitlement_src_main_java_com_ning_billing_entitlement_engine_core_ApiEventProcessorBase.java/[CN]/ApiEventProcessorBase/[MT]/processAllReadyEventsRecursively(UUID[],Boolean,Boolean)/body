{
  int curSequenceId=sequenceId.getAndIncrement();
  List<IEntitlementEvent> claimedEvents=new LinkedList<IEntitlementEvent>();
  do {
    List<IEntitlementEvent> tmpEvents=dao.getEventsReady(apiProcessorId,curSequenceId);
    if (tmpEvents.size() == 0) {
      break;
    }
    claimedEvents.addAll(tmpEvents);
  }
 while (true);
  if (claimedEvents.size() == 0) {
    return false;
  }
  Collection<IEntitlementEvent> claimedEventsFiltered=null;
  if (subscriptionsIds.length == 0) {
    claimedEventsFiltered=claimedEvents;
  }
 else {
    claimedEventsFiltered=Collections2.filter(claimedEvents,new Predicate<IEntitlementEvent>(){
      @Override public boolean apply(      IEntitlementEvent input){
        for (        UUID cur : subscriptionsIds) {
          if (cur.equals(input.getSubscriptionId())) {
            return true;
          }
        }
        return false;
      }
    }
);
  }
  if (claimedEventsFiltered.size() == 0) {
    return false;
  }
  if (oneEventOnly) {
    List<IEntitlementEvent> oneEventList=new ArrayList<IEntitlementEvent>(1);
    oneEventList.add(claimedEventsFiltered.iterator().next());
    claimedEventsFiltered=oneEventList;
  }
  doProcessEventsFromList(curSequenceId,claimedEventsFiltered);
  if (recursive && !oneEventOnly) {
    processAllReadyEventsRecursively(subscriptionsIds,recursive,oneEventOnly);
  }
  return true;
}
