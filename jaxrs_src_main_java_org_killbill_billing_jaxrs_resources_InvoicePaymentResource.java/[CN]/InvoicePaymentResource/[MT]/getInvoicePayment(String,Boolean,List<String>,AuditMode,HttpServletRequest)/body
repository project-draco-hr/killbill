{
  final Iterable<PluginProperty> pluginProperties=extractPluginProperties(pluginPropertiesString);
  final UUID directPaymentIdId=UUID.fromString(directPaymentIdStr);
  final TenantContext tenantContext=context.createContext(request);
  final DirectPayment directPayment=paymentApi.getPayment(directPaymentIdId,withPluginInfo,pluginProperties,tenantContext);
  final AccountAuditLogs accountAuditLogs=auditUserApi.getAccountAuditLogs(directPayment.getAccountId(),auditMode.getLevel(),tenantContext);
  final List<InvoicePayment> invoicePayments=invoicePaymentApi.getInvoicePayments(directPaymentIdId,tenantContext);
  final InvoicePayment invoicePayment=Iterables.tryFind(invoicePayments,new Predicate<InvoicePayment>(){
    @Override public boolean apply(    final InvoicePayment input){
      return input.getType() == InvoicePaymentType.ATTEMPT;
    }
  }
).orNull();
  final UUID invoiceId=invoicePayment != null ? invoicePayment.getInvoiceId() : null;
  final InvoicePaymentJson result=new InvoicePaymentJson(directPayment,invoiceId,accountAuditLogs);
  return Response.status(Response.Status.OK).entity(result).build();
}
