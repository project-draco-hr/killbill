{
  if (policy == BillingActionPolicy.IMMEDIATE) {
    return requestedDate.compareTo(clock.getUTCNow()) < 0 ? requestedDate : clock.getUTCNow();
  }
  if (policy != BillingActionPolicy.END_OF_TERM) {
    throw new SubscriptionBaseError(String.format("Unexpected policy type %s",policy.toString()));
  }
  if (chargedThroughDate == null) {
    return requestedDate;
  }
 else {
    return chargedThroughDate.isBefore(requestedDate) ? requestedDate : chargedThroughDate;
  }
}
