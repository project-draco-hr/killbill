{
  final UUID accountId=internalCallContextFactory.getAccountId(entitlementId,ObjectType.SUBSCRIPTION,context);
  final AccountEntitlements accountEntitlements;
  try {
    accountEntitlements=entitlementInternalApi.getAllEntitlementsForAccountId(accountId,context);
  }
 catch (  final EntitlementApiException e) {
    throw new SubscriptionApiException(e);
  }
  final Iterable<Subscription> accountSubscriptions=Iterables.<Subscription>concat(buildSubscriptionsFromEntitlements(accountEntitlements).values());
  return Iterables.<Subscription>find(accountSubscriptions,new Predicate<Subscription>(){
    @Override public boolean apply(    final Subscription subscription){
      return subscription.getId().equals(entitlementId);
    }
  }
);
}
