{
  final Account account=createAccountWithDefaultPaymentMethod();
  final DirectTransaction authTransaction=new DirectTransaction();
  authTransaction.setAmount(BigDecimal.TEN);
  authTransaction.setCurrency(account.getCurrency());
  authTransaction.setExternalKey("foo");
  authTransaction.setTransactionType("AUTHORIZE");
  final DirectPayment authDirectPayment=killBillClient.createDirectPayment(account.getAccountId(),authTransaction,createdBy,reason,comment);
  verifyDirectPayment(account,authDirectPayment,BigDecimal.TEN,BigDecimal.ZERO,BigDecimal.ZERO,1);
  final DirectTransaction captureTransaction=new DirectTransaction();
  captureTransaction.setDirectPaymentId(authDirectPayment.getDirectPaymentId());
  captureTransaction.setAmount(BigDecimal.ONE);
  captureTransaction.setCurrency(account.getCurrency());
  final DirectPayment capturedDirectPayment1=killBillClient.captureAuthorization(captureTransaction,createdBy,reason,comment);
  verifyDirectPayment(account,capturedDirectPayment1,BigDecimal.TEN,BigDecimal.ONE,BigDecimal.ZERO,2);
  verifyDirectPaymentTransaction(authDirectPayment.getDirectPaymentId(),capturedDirectPayment1.getTransactions().get(1),account,captureTransaction.getAmount(),"CAPTURE");
  final DirectPayment capturedDirectPayment2=killBillClient.captureAuthorization(captureTransaction,createdBy,reason,comment);
  verifyDirectPayment(account,capturedDirectPayment2,BigDecimal.TEN,new BigDecimal("2"),BigDecimal.ZERO,3);
  verifyDirectPaymentTransaction(authDirectPayment.getDirectPaymentId(),capturedDirectPayment2.getTransactions().get(2),account,captureTransaction.getAmount(),"CAPTURE");
  final DirectTransaction creditTransaction=new DirectTransaction();
  creditTransaction.setDirectPaymentId(authDirectPayment.getDirectPaymentId());
  creditTransaction.setAmount(new BigDecimal("223.12"));
  creditTransaction.setCurrency(account.getCurrency());
  final DirectPayment creditDirectPayment=killBillClient.creditPayment(creditTransaction,createdBy,reason,comment);
  verifyDirectPayment(account,creditDirectPayment,BigDecimal.TEN,new BigDecimal("2"),new BigDecimal("223.12"),4);
  verifyDirectPaymentTransaction(authDirectPayment.getDirectPaymentId(),creditDirectPayment.getTransactions().get(3),account,creditTransaction.getAmount(),"CREDIT");
  final DirectPayment voidDirectPayment=killBillClient.voidPayment(authDirectPayment.getDirectPaymentId(),createdBy,reason,comment);
  verifyDirectPayment(account,voidDirectPayment,BigDecimal.TEN,new BigDecimal("2"),new BigDecimal("223.12"),5);
  verifyDirectPaymentTransaction(authDirectPayment.getDirectPaymentId(),voidDirectPayment.getTransactions().get(4),account,null,"VOID");
}
