{
  return dispatchWithAccountLockAndTimeout(new WithAccountLockCallback<PluginDispatcherReturnType<OperationResult>,OperationException>(){
    @Override public PluginDispatcherReturnType<OperationResult> doOperation() throws OperationException {
      final PaymentTransactionModelDao transaction=paymentStateContext.getPaymentTransactionModelDao();
      final PaymentRoutingContext updatedPaymentControlContext=new DefaultPaymentRoutingContext(paymentStateContext.getAccount(),paymentStateContext.getPaymentMethodId(),paymentStateControlContext.getAttemptId(),transaction.getPaymentId(),paymentStateContext.getPaymentExternalKey(),transaction.getId(),paymentStateContext.getPaymentTransactionExternalKey(),paymentStateContext.getTransactionType(),transaction.getAmount(),transaction.getCurrency(),transaction.getProcessedAmount(),transaction.getProcessedCurrency(),paymentStateContext.getProperties(),paymentStateControlContext.isApiPayment(),paymentStateContext.getCallContext());
      executePluginOnSuccessCalls(paymentStateControlContext.getPaymentControlPluginNames(),updatedPaymentControlContext);
      return PluginDispatcher.createPluginDispatcherReturnType(OperationResult.SUCCESS);
    }
  }
);
}
