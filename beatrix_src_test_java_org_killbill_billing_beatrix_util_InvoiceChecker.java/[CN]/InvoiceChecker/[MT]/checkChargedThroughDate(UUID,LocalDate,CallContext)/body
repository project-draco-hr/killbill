{
  try {
    final DefaultEntitlement entitlement=(DefaultEntitlement)entitlementApi.getEntitlementForId(entitlementId,context);
    final SubscriptionBase subscription=entitlement.getSubscriptionBase();
    if (expectedLocalCTD == null) {
      assertNull(subscription.getChargedThroughDate());
    }
 else {
      assertTrue(expectedLocalCTD.compareTo(subscription.getChargedThroughDate().toLocalDate()) == 0);
    }
  }
 catch (  EntitlementApiException e) {
    fail("Failed to retrieve entitlement for " + entitlementId);
  }
}
