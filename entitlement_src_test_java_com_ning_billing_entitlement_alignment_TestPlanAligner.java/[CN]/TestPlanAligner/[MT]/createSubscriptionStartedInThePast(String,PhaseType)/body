{
  final DefaultSubscriptionFactory.SubscriptionBuilder builder=new DefaultSubscriptionFactory.SubscriptionBuilder();
  builder.setBundleStartDate(clock.getUTCNow().minusHours(10));
  builder.setAlignStartDate(new DateTime(builder.getBundleStartDate().plusHours(5)));
  final SubscriptionData subscriptionData=new SubscriptionData(builder,null,clock);
  final EntitlementEvent event=createEntitlementEvent(builder.getAlignStartDate(),productName,phaseType,ApiEventType.CREATE,subscriptionData.getActiveVersion());
  subscriptionData.rebuildTransitions(ImmutableList.<EntitlementEvent>of(event),catalogService.getFullCatalog());
  Assert.assertEquals(subscriptionData.getAllTransitions().size(),1);
  Assert.assertNull(subscriptionData.getAllTransitions().get(0).getPreviousPhase());
  Assert.assertNotNull(subscriptionData.getAllTransitions().get(0).getNextPhase());
  return subscriptionData;
}
