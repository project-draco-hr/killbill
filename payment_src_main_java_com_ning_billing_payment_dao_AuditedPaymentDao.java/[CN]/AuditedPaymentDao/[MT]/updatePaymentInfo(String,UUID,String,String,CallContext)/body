{
  paymentSqlDao.inTransaction(new Transaction<Void,PaymentSqlDao>(){
    @Override public Void inTransaction(    PaymentSqlDao transactional,    TransactionStatus status) throws Exception {
      transactional.updatePaymentInfo(type,paymentId.toString(),cardType,cardCountry,context);
      PaymentInfoEvent paymentInfo=transactional.getPaymentInfo(paymentId.toString());
      Long recordId=transactional.getRecordId(paymentId.toString());
      EntityHistory<PaymentInfoEvent> history=new EntityHistory<PaymentInfoEvent>(paymentInfo.getId(),recordId,paymentInfo,ChangeType.UPDATE);
      transactional.insertHistoryFromTransaction(history,context);
      Long historyRecordId=transactional.getHistoryRecordId(recordId);
      EntityAudit audit=new EntityAudit(TableName.PAYMENT_HISTORY,historyRecordId,ChangeType.UPDATE);
      transactional.insertAuditFromTransaction(audit,context);
      return null;
    }
  }
);
}
