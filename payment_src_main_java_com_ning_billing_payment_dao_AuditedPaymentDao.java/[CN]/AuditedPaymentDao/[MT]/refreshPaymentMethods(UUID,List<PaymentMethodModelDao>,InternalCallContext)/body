{
  return transactionalSqlDao.execute(new EntitySqlDaoTransactionWrapper<List<PaymentMethodModelDao>>(){
    @Override public List<PaymentMethodModelDao> inTransaction(    final EntitySqlDaoWrapperFactory<EntitySqlDao> entitySqlDaoWrapperFactory) throws Exception {
      final PaymentMethodSqlDao transactional=entitySqlDaoWrapperFactory.become(PaymentMethodSqlDao.class);
      final List<PaymentMethodModelDao> existingPaymentMethods=transactional.getPaymentMethods(accountId.toString(),context);
      final Set<String> externalPaymentIdProcessed=new HashSet<String>();
      for (      final PaymentMethodModelDao finalPaymentMethod : paymentMethods) {
        boolean isExistingPaymentMethod=false;
        for (        final PaymentMethodModelDao existingPaymentMethod : existingPaymentMethods) {
          if (existingPaymentMethod.equals(finalPaymentMethod)) {
            isExistingPaymentMethod=true;
            break;
          }
 else           if (existingPaymentMethod.equalsButActive(finalPaymentMethod)) {
            undeletedPaymentMethodInTransaction(entitySqlDaoWrapperFactory,existingPaymentMethod.getId(),context);
            isExistingPaymentMethod=true;
            break;
          }
        }
        if (!isExistingPaymentMethod) {
          insertPaymentMethodInTransaction(entitySqlDaoWrapperFactory,finalPaymentMethod,context);
        }
        externalPaymentIdProcessed.add(finalPaymentMethod.getExternalId());
      }
      for (      final PaymentMethodModelDao existingPaymentMethod : existingPaymentMethods) {
        if (!externalPaymentIdProcessed.contains(existingPaymentMethod.getExternalId())) {
          deletedPaymentMethodInTransaction(entitySqlDaoWrapperFactory,existingPaymentMethod.getId(),context);
        }
      }
      return transactional.getPaymentMethods(accountId.toString(),context);
    }
  }
);
}
