{
  sqlDao.inTransaction(new Transaction<Void,PaymentSqlDao>(){
    @Override public Void inTransaction(    PaymentSqlDao transactional,    TransactionStatus status) throws Exception {
      transactional.updatePaymentInfo(type,paymentId,cardType,cardCountry,context);
      PaymentInfo paymentInfo=transactional.getPaymentInfo(paymentId.toString());
      UUID historyRecordId=UUID.randomUUID();
      transactional.insertPaymentInfoHistory(historyRecordId.toString(),paymentInfo,context);
      AuditSqlDao auditSqlDao=transactional.become(AuditSqlDao.class);
      auditSqlDao.insertAuditFromTransaction("payments",historyRecordId.toString(),ChangeType.UPDATE.toString(),context);
      return null;
    }
  }
);
}
