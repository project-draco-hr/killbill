{
  transactional.updatePaymentStatusAndExtRef(paymentId.toString(),paymentStatus.toString(),extFirstPaymentRefId,extSecondPaymentRefId,context);
  final PaymentModelDao savedPayment=transactional.getPayment(paymentId.toString(),context);
  final Long recordId=transactional.getRecordId(savedPayment.getId().toString(),context);
  final EntityHistory<PaymentModelDao> history=new EntityHistory<PaymentModelDao>(savedPayment.getId(),recordId,savedPayment,ChangeType.UPDATE);
  transactional.insertHistoryFromTransaction(history,context);
  final Long historyRecordId=transactional.getHistoryRecordId(recordId,context);
  final EntityAudit audit=new EntityAudit(TableName.PAYMENT_HISTORY,historyRecordId,ChangeType.UPDATE);
  transactional.insertAuditFromTransaction(audit,context);
}
