{
  return paymentMethodSqlDao.inTransaction(new Transaction<List<PaymentMethodModelDao>,PaymentMethodSqlDao>(){
    @Override public List<PaymentMethodModelDao> inTransaction(    final PaymentMethodSqlDao transactional,    final TransactionStatus status) throws Exception {
      final List<PaymentMethodModelDao> existingPaymentMethods=getPaymentMethodsInTransaction(transactional,accountId);
      for (      final PaymentMethodModelDao finalPaymentMethod : paymentMethods) {
        boolean isExistingPaymentMethod=false;
        for (        final PaymentMethodModelDao existingPaymentMethod : existingPaymentMethods) {
          if (existingPaymentMethod.equals(finalPaymentMethod)) {
            isExistingPaymentMethod=true;
            break;
          }
 else           if (existingPaymentMethod.equalsButActive(finalPaymentMethod)) {
            if (finalPaymentMethod.isActive()) {
              undeletedPaymentMethodInTransaction(transactional,existingPaymentMethod.getId());
            }
 else {
              deletedPaymentMethodInTransaction(transactional,existingPaymentMethod.getId());
            }
            isExistingPaymentMethod=true;
            break;
          }
        }
        if (!isExistingPaymentMethod) {
          insertPaymentMethodInTransaction(transactional,finalPaymentMethod,context);
        }
      }
      return getPaymentMethodsInTransaction(transactional,accountId);
    }
  }
);
}
