{
  final Account accountJson=createAccountNoPMBundleAndSubscriptionAndWaitForFirstInvoice();
  final List<Invoice> invoices=killBillClient.getInvoicesForAccount(accountJson.getAccountId());
  assertEquals(invoices.size(),2);
  Assert.assertTrue(killBillClient.getOverdueStateForAccount(accountJson.getAccountId()).getIsClearState());
  clock.addDays(30);
  crappyWaitForLackOfProperSynchonization();
  Assert.assertEquals(killBillClient.getOverdueStateForAccount(accountJson.getAccountId()).getName(),"OD1");
  clock.addDays(10);
  crappyWaitForLackOfProperSynchonization();
  Assert.assertEquals(killBillClient.getOverdueStateForAccount(accountJson.getAccountId()).getName(),"OD2");
  clock.addDays(10);
  crappyWaitForLackOfProperSynchonization();
  Assert.assertEquals(killBillClient.getOverdueStateForAccount(accountJson.getAccountId()).getName(),"OD3");
  for (  final Invoice invoice : killBillClient.getInvoicesForAccount(accountJson.getAccountId())) {
    if (invoice.getBalance().compareTo(BigDecimal.ZERO) > 0) {
      final Payment payment=new Payment();
      payment.setAccountId(accountJson.getAccountId());
      payment.setInvoiceId(invoice.getInvoiceId());
      payment.setAmount(invoice.getBalance());
      killBillClient.createPayment(payment,true,createdBy,reason,comment);
    }
  }
  crappyWaitForLackOfProperSynchonization();
  Assert.assertTrue(killBillClient.getOverdueStateForAccount(accountJson.getAccountId()).getIsClearState());
}
