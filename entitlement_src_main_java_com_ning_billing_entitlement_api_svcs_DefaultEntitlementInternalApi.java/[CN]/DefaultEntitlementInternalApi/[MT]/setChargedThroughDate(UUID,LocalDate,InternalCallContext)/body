{
  final SubscriptionData subscription=(SubscriptionData)dao.getSubscriptionFromId(subscriptionFactory,subscriptionId,context);
  final DateTime chargedThroughDate=localChargedThruDate.toDateTime(new LocalTime(subscription.getStartDate(),DateTimeZone.UTC),DateTimeZone.UTC);
  final SubscriptionBuilder builder=new SubscriptionBuilder(subscription).setChargedThroughDate(chargedThroughDate).setPaidThroughDate(subscription.getPaidThroughDate());
  log.info("Setting CTD for subscription {} to {} ({} local)",new Object[]{subscriptionId,chargedThroughDate,localChargedThruDate});
  dao.updateChargedThroughDate(new SubscriptionData(builder),context);
}
