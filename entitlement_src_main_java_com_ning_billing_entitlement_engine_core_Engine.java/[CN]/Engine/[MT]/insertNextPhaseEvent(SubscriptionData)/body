{
  try {
    DateTime now=clock.getUTCNow();
    TimedPhase nextTimedPhase=planAligner.getNextTimedPhase(subscription.getCurrentPlan(),subscription.getInitialPhaseOnCurrentPlan().getPhaseType(),now,subscription.getCurrentPlanStart());
    PhaseEvent nextPhaseEvent=(nextTimedPhase != null) ? PhaseEventData.getNextPhaseEvent(nextTimedPhase.getPhase().getName(),subscription,now,nextTimedPhase.getStartPhase()) : null;
    if (nextPhaseEvent != null) {
      dao.createNextPhaseEvent(subscription.getId(),nextPhaseEvent);
    }
  }
 catch (  EntitlementError e) {
    log.error(String.format("Failed to insert next phase for subscription %s",subscription.getId()),e);
  }
}
