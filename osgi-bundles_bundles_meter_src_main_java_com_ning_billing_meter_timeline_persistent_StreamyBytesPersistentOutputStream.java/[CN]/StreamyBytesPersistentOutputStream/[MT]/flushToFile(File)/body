{
  final byte[] buf=new byte[BUF_SIZE];
  FileOutputStream transfer=null;
  int bytesTransferred=0;
  try {
    transfer=Files.newOutputStreamSupplier(out).getOutput();
    while (true) {
      final int r=inputBuffer.readIfAvailable(buf);
      if (r == 0) {
        break;
      }
      transfer.write(buf,0,r);
      bytesTransferred+=r;
    }
  }
  finally {
    if (transfer != null) {
      try {
        transfer.write(SmileConstants.TOKEN_LITERAL_END_ARRAY);
        bytesTransferred++;
        bytesOnDisk+=bytesTransferred;
      }
  finally {
        transfer.flush();
      }
    }
  }
  log.debug("Saved {} bytes to disk",bytesTransferred);
}
