{
  final EffectiveSubscriptionInternalEvent transition=eventWithMetadata.getEvent();
  try {
    if (transition.getTransitionType() == SubscriptionTransitionType.UNCANCEL || transition.getTransitionType() == SubscriptionTransitionType.MIGRATE_ENTITLEMENT || transition.getRemainingEventsForUserOperation() > 0) {
      return;
    }
    final InternalCallContext context=internalCallContextFactory.createInternalCallContext(eventWithMetadata.getSearchKey2(),eventWithMetadata.getSearchKey1(),"SubscriptionTransition",CallOrigin.INTERNAL,UserType.SYSTEM,eventWithMetadata.getUserToken());
    dispatcher.processSubscription(transition,context);
  }
 catch (  InvoiceApiException e) {
    log.error(e.getMessage());
  }
}
