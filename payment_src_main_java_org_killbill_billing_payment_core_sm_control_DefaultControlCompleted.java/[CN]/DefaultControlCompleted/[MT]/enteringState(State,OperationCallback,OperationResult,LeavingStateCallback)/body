{
  final PaymentAttemptModelDao attempt=retryablePaymentAutomatonRunner.getPaymentDao().getPaymentAttempt(paymentStateContext.getAttemptId(),paymentStateContext.getInternalCallContext());
  final UUID transactionId=paymentStateContext.getCurrentTransaction() != null ? paymentStateContext.getCurrentTransaction().getId() : null;
  if (retriedState.getName().equals(state.getName()) && !isUnknownTransaction()) {
    retryablePaymentAutomatonRunner.getPaymentDao().updatePaymentAttemptWithProperties(attempt.getId(),transactionId,state.getName(),getSerializedProperties(),paymentStateContext.getInternalCallContext());
    retryServiceScheduler.scheduleRetry(ObjectType.PAYMENT_ATTEMPT,attempt.getId(),attempt.getId(),attempt.getTenantRecordId(),paymentStateContext.getPaymentControlPluginNames(),paymentStateContext.getRetryDate());
  }
 else {
    retryablePaymentAutomatonRunner.getPaymentDao().updatePaymentAttempt(attempt.getId(),transactionId,state.getName(),paymentStateContext.getInternalCallContext());
  }
}
