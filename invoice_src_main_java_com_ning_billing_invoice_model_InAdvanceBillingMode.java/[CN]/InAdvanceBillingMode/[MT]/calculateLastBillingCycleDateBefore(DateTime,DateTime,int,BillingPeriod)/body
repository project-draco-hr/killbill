{
  DateTime proposedDate=previousBillCycleDate;
  proposedDate=proposedDate.plusMonths(billingPeriod.getNumberOfMonths());
  if (!proposedDate.isBefore(date)) {
    return previousBillCycleDate;
  }
  while (proposedDate.isBefore(date)) {
    proposedDate=proposedDate.plusMonths(billingPeriod.getNumberOfMonths());
  }
  proposedDate=proposedDate.plusMonths(-billingPeriod.getNumberOfMonths());
  if (proposedDate.dayOfMonth().get() < billingCycleDay) {
    int lastDayOfTheMonth=proposedDate.dayOfMonth().getMaximumValue();
    if (lastDayOfTheMonth < billingCycleDay) {
      return new DateTime(proposedDate.getYear(),proposedDate.getMonthOfYear(),lastDayOfTheMonth,proposedDate.getHourOfDay(),proposedDate.getMinuteOfHour(),proposedDate.getSecondOfMinute(),proposedDate.getMillisOfSecond());
    }
 else {
      return new DateTime(proposedDate.getYear(),proposedDate.getMonthOfYear(),billingCycleDay,proposedDate.getHourOfDay(),proposedDate.getMinuteOfHour(),proposedDate.getSecondOfMinute(),proposedDate.getMillisOfSecond());
    }
  }
 else {
    return proposedDate;
  }
}
