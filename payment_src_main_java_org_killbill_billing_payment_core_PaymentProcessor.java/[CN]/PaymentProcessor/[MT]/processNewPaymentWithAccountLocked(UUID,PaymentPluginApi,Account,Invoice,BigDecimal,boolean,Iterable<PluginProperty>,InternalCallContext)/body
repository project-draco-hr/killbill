{
  final PaymentModelDao payment=new PaymentModelDao(account.getId(),invoice.getId(),paymentMethodId,requestedAmount,invoice.getCurrency(),clock.getUTCNow());
  final PaymentAttemptModelDao attempt=new PaymentAttemptModelDao(account.getId(),invoice.getId(),payment.getId(),paymentMethodId,clock.getUTCNow(),requestedAmount,invoice.getCurrency());
  final PaymentModelDao savedPayment=paymentDao.insertPaymentWithFirstAttempt(payment,attempt,context);
  return processPaymentWithAccountLocked(plugin,account,invoice,savedPayment,attempt,isInstantPayment,properties,context);
}
