{
  final String key=account.getExternalKey();
  final String objectType=DefaultAccount.OBJECT_TYPE;
  accountDao.inTransaction(new Transaction<Void,AccountSqlDao>(){
    @Override public Void inTransaction(    AccountSqlDao accountDao,    TransactionStatus status) throws Exception {
      Account currentAccount=accountDao.getAccountByKey(key);
      if (currentAccount != null) {
        throw new AccountApiException(ErrorCode.ACCOUNT_ALREADY_EXISTS,account.getExternalKey());
      }
      accountDao.create(account);
      String accountId=account.getId().toString();
      FieldStoreDao fieldStoreDao=accountDao.become(FieldStoreDao.class);
      List<CustomField> fieldList=account.getFieldList();
      if (fieldList != null) {
        fieldStoreDao.save(accountId,objectType,account.getFieldList());
      }
      TagStoreDao tagStoreDao=fieldStoreDao.become(TagStoreDao.class);
      List<Tag> tagList=account.getTagList();
      if (tagList != null) {
        tagStoreDao.save(accountId,objectType,account.getTagList());
      }
      AccountCreationNotification creationEvent=new DefaultAccountCreationEvent(account);
      eventBus.post(creationEvent);
      return null;
    }
  }
);
}
