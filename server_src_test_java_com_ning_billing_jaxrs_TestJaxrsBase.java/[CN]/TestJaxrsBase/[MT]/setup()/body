{
  loadSystemPropertiesFromClasspath("/killbill.properties");
  final EventListener eventListener=new TestKillbillGuiceListener();
  httpClient=new AsyncHttpClient();
  server=new HttpServer();
  config=getConfig();
  mapper=new ObjectMapper();
  final Iterable<EventListener> eventListeners=new Iterable<EventListener>(){
    @Override public Iterator<EventListener> iterator(){
      ArrayList<EventListener> array=new ArrayList<EventListener>();
      array.add(eventListener);
      return array.iterator();
    }
  }
;
  server.configure(config,eventListeners,new HashMap<FilterHolder,String>());
  server.start();
  Injector injector=((TestKillbillGuiceListener)eventListener).getTheInjector();
  helper=injector.getInstance(MysqlTestingHelper.class);
  clock=(ClockMock)injector.getInstance(Clock.class);
  busHandler=new TestBusHandler();
}
