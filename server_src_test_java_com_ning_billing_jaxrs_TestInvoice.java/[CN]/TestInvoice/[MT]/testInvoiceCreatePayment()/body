{
  clock.setTime(new DateTime(2012,4,25,0,3,42,0));
  final Account accountJson=createAccountWithPMBundleAndSubscriptionAndWaitForFirstInvoice();
  final List<Invoice> invoices=killBillClient.getInvoicesForAccount(accountJson.getAccountId());
  assertEquals(invoices.size(),2);
  for (  final Invoice cur : invoices) {
    if (cur.getBalance().compareTo(BigDecimal.ZERO) <= 0) {
      continue;
    }
    final Payment payment=new Payment();
    payment.setAccountId(accountJson.getAccountId());
    payment.setInvoiceId(cur.getInvoiceId());
    payment.setAmount(cur.getBalance());
    final List<Payment> objFromJson=killBillClient.createPayment(payment,false,createdBy,reason,comment);
    assertEquals(objFromJson.size(),1);
    assertEquals(cur.getBalance().compareTo(objFromJson.get(0).getAmount()),0);
  }
}
