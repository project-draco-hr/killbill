{
  final AccountJson accountJson=createAccountNoPMBundleAndSubscriptionAndWaitForFirstInvoice();
  final List<PaymentJson> noPaymentsFromJson=getPaymentsForAccount(accountJson.getAccountId());
  assertEquals(noPaymentsFromJson.size(),0);
  final List<InvoiceJsonSimple> invoices=getInvoicesForAccount(accountJson.getAccountId());
  assertEquals(invoices.size(),2);
  final String invoiceId=invoices.get(1).getInvoiceId();
  final BigDecimal paidAmount=BigDecimal.TEN;
  createExternalPayment(accountJson,invoiceId,paidAmount);
  final List<PaymentJson> paymentsFromJson=getPaymentsForAccount(accountJson.getAccountId());
  assertEquals(paymentsFromJson.size(),1);
  assertEquals(paymentsFromJson.get(0).getPaidAmount().compareTo(paidAmount),0);
  final String paymentMethodId=paymentsFromJson.get(0).getPaymentMethodId();
  final PaymentMethodJson paymentMethodJson=getPaymentMethod(paymentMethodId);
  assertEquals(paymentMethodJson.getPaymentMethodId(),paymentMethodId);
  assertEquals(paymentMethodJson.getAccountId(),accountJson.getAccountId());
  assertEquals(paymentMethodJson.getPluginName(),ExternalPaymentProviderPlugin.PLUGIN_NAME);
  assertNull(paymentMethodJson.getPluginInfo());
}
