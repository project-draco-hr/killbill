{
  final Account accountJson=createAccountNoPMBundleAndSubscriptionAndWaitForFirstInvoice();
  final List<Invoice> invoices=killBillClient.getInvoicesForAccount(accountJson.getAccountId(),true);
  assertEquals(invoices.size(),2);
  final Invoice invoice=invoices.get(1);
  assertEquals(invoice.getAmount().compareTo(BigDecimal.ZERO),1);
  final InvoiceItem invoiceItem=invoice.getItems().get(0);
  assertEquals(invoiceItem.getAmount().compareTo(BigDecimal.ZERO),1);
  final InvoiceItem adjustmentInvoiceItem=new InvoiceItem();
  adjustmentInvoiceItem.setAccountId(accountJson.getAccountId());
  adjustmentInvoiceItem.setInvoiceId(invoice.getInvoiceId());
  adjustmentInvoiceItem.setInvoiceItemId(invoiceItem.getInvoiceItemId());
  killBillClient.adjustInvoiceItem(invoiceItem,createdBy,reason,comment);
  final Invoice adjustedInvoice=killBillClient.getInvoice(invoice.getInvoiceId(),true,AuditLevel.FULL);
  assertEquals(adjustedInvoice.getAmount().compareTo(BigDecimal.ZERO),0);
  Assert.assertEquals(adjustedInvoice.getAuditLogs().size(),1);
  final AuditLog invoiceAuditLogJson=adjustedInvoice.getAuditLogs().get(0);
  Assert.assertEquals(invoiceAuditLogJson.getChangeType(),"INSERT");
  Assert.assertEquals(invoiceAuditLogJson.getChangedBy(),"SubscriptionBaseTransition");
  Assert.assertNotNull(invoiceAuditLogJson.getChangeDate());
  Assert.assertNotNull(invoiceAuditLogJson.getUserToken());
  Assert.assertNull(invoiceAuditLogJson.getReasonCode());
  Assert.assertNull(invoiceAuditLogJson.getComments());
  Assert.assertEquals(adjustedInvoice.getItems().size(),2);
  Assert.assertEquals(adjustedInvoice.getItems().get(0).getAuditLogs().size(),1);
  final AuditLog itemAuditLogJson=adjustedInvoice.getItems().get(0).getAuditLogs().get(0);
  Assert.assertEquals(itemAuditLogJson.getChangeType(),"INSERT");
  Assert.assertEquals(itemAuditLogJson.getChangedBy(),"SubscriptionBaseTransition");
  Assert.assertNotNull(itemAuditLogJson.getChangeDate());
  Assert.assertNotNull(itemAuditLogJson.getUserToken());
  Assert.assertNull(itemAuditLogJson.getReasonCode());
  Assert.assertNull(itemAuditLogJson.getComments());
  Assert.assertEquals(adjustedInvoice.getItems().get(1).getAuditLogs().size(),1);
  final AuditLog adjustedItemAuditLogJson=adjustedInvoice.getItems().get(1).getAuditLogs().get(0);
  Assert.assertEquals(adjustedItemAuditLogJson.getChangeType(),"INSERT");
  Assert.assertEquals(adjustedItemAuditLogJson.getChangedBy(),createdBy);
  Assert.assertEquals(adjustedItemAuditLogJson.getReasonCode(),reason);
  Assert.assertEquals(adjustedItemAuditLogJson.getComments(),comment);
  Assert.assertNotNull(adjustedItemAuditLogJson.getChangeDate());
  Assert.assertNotNull(adjustedItemAuditLogJson.getUserToken());
}
