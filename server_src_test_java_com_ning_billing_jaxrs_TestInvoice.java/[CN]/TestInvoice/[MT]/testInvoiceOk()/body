{
  final DateTime initialDate=new DateTime(2012,4,25,0,3,42,0);
  clock.setDeltaFromReality(initialDate.getMillis() - clock.getUTCNow().getMillis());
  final AccountJson accountJson=createAccountWithPMBundleAndSubscriptionAndWaitForFirstInvoice();
  final List<InvoiceJsonSimple> invoices=getInvoicesForAccount(accountJson.getAccountId());
  assertEquals(invoices.size(),2);
  final InvoiceJsonSimple invoiceJsonSimple=invoices.get(0);
  final InvoiceJsonSimple firstInvoiceJson=getInvoice(invoiceJsonSimple.getInvoiceId());
  assertEquals(firstInvoiceJson,invoiceJsonSimple);
  final DateTime futureDate=clock.getUTCNow().plusMonths(1).plusDays(3);
  createDryRunInvoice(accountJson.getAccountId(),futureDate);
  createInvoice(accountJson.getAccountId(),futureDate);
  final List<InvoiceJsonSimple> newInvoiceList=getInvoicesForAccount(accountJson.getAccountId());
  assertEquals(newInvoiceList.size(),3);
}
