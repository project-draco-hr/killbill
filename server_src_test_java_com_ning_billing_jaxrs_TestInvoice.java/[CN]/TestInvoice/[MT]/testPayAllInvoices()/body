{
  clock.setTime(new DateTime(2012,4,25,0,3,42,0));
  final AccountJson accountJson=createAccountNoPMBundleAndSubscriptionAndWaitForFirstInvoice();
  assertEquals(getPaymentsForAccount(accountJson.getAccountId()).size(),0);
  final List<InvoiceJsonSimple> invoices=getInvoicesForAccount(accountJson.getAccountId());
  assertEquals(invoices.size(),2);
  final InvoiceJsonSimple invoiceToPay=invoices.get(1);
  assertEquals(invoiceToPay.getBalance().compareTo(BigDecimal.ZERO),1);
  payAllInvoices(accountJson,true);
  for (  final InvoiceJsonSimple invoice : getInvoicesForAccount(accountJson.getAccountId())) {
    assertEquals(invoice.getBalance().compareTo(BigDecimal.ZERO),0);
  }
  assertEquals(getPaymentsForAccount(accountJson.getAccountId()).size(),1);
}
