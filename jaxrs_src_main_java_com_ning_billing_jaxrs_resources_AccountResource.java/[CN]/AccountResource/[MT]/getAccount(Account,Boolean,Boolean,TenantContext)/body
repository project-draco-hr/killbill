{
  final AccountJson json;
  if (accountWithBalanceAndCBA) {
    final BigDecimal accountBalance=invoiceApi.getAccountBalance(account.getId(),tenantContext);
    final BigDecimal accountCBA=invoiceApi.getAccountCBA(account.getId(),tenantContext);
    return new AccountJsonWithBalanceAndCBA(account,accountBalance,accountCBA);
  }
 else   if (accountWithBalance) {
    final BigDecimal accountBalance=invoiceApi.getAccountBalance(account.getId(),tenantContext);
    return new AccountJsonWithBalance(account,accountBalance);
  }
 else {
    return new AccountJson(account);
  }
}
