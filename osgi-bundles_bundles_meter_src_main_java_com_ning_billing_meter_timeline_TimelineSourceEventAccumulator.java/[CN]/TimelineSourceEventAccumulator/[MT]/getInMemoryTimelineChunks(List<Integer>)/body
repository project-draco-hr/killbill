{
  final List<TimelineChunk> timelineChunks=new ArrayList<TimelineChunk>();
  for (  final PendingChunkMap pendingChunkMap : pendingChunkMaps) {
    for (    final Integer metricId : metricIds) {
      final TimelineChunk timelineChunkForMetricId=pendingChunkMap.getChunkMap().get(metricId);
      if (timelineChunkForMetricId != null) {
        timelineChunks.add(timelineChunkForMetricId);
      }
    }
  }
  final byte[] timeBytes=timelineCoder.compressDateTimes(times);
  for (  final Integer metricId : metricIds) {
    final TimelineChunkAccumulator chunkAccumulator=timelines.get(metricId);
    if (chunkAccumulator != null) {
      final TimelineChunkAccumulator chunkAccumulatorCopy=chunkAccumulator.deepCopy();
      final TimelineChunk timelineChunk=chunkAccumulatorCopy.extractTimelineChunkAndReset(startTime,endTime,timeBytes);
      timelineChunks.add(timelineChunk);
    }
  }
  return timelineChunks;
}
