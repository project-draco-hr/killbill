{
synchronized (monitor) {
    invoices.put(invoice.getId(),invoice);
    for (    final InvoiceItemModelDao invoiceItemModelDao : invoiceItems) {
      items.put(invoiceItemModelDao.getId(),invoiceItemModelDao);
    }
    for (    final InvoicePaymentModelDao paymentModelDao : invoicePayments) {
      payments.put(paymentModelDao.getId(),paymentModelDao);
    }
    accountRecordIds.put(invoice.getAccountId(),context.getAccountRecordId());
  }
  try {
    eventBus.post(new DefaultInvoiceCreationEvent(invoice.getId(),invoice.getAccountId(),InvoiceModelDaoHelper.getBalance(invoice),invoice.getCurrency(),context.getAccountRecordId(),context.getTenantRecordId(),context.getUserToken()));
  }
 catch (  PersistentBus.EventBusException ex) {
    throw new RuntimeException(ex);
  }
}
