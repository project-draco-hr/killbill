{
  Product product1=cat.getProducts()[0];
  Product product2=cat.getProducts()[1];
  PriceList priceList1=cat.getPriceListFromName(IPriceListSet.DEFAULT_PRICELIST_NAME);
  PriceList priceList2=cat.getPriceLists().getChildPriceLists()[0];
  PlanPhaseSpecifier from=new PlanPhaseSpecifier(product1.getName(),product1.getCategory(),BillingPeriod.MONTHLY,priceList1.getName(),PhaseType.EVERGREEN);
  PlanSpecifier to=new PlanSpecifier(product2.getName(),product2.getCategory(),BillingPeriod.MONTHLY,null);
  PlanChangeResult result=null;
  try {
    result=cat.getPlanRules().planChange(from,to,cat);
  }
 catch (  IllegalPlanChange e) {
    log.info("Correct - cannot change to the same plan:",e);
    Assert.fail("We should not have triggered this error");
  }
catch (  CatalogApiException e) {
    Assert.fail("",e);
  }
  Assert.assertEquals(result.getPolicy(),ActionPolicy.END_OF_TERM);
  Assert.assertEquals(result.getAlignment(),PlanAlignmentChange.START_OF_SUBSCRIPTION);
  Assert.assertEquals(result.getNewPriceList(),priceList2);
}
