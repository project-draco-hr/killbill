{
  if (config.isNotificationProcessingOff()) {
    completedQueueStop();
    return;
  }
synchronized (this) {
    isProcessingEvents=false;
    try {
      log.info("NotificationQueue requested to stop");
      wait(STOP_WAIT_TIMEOUT_MS);
      log.info("NotificationQueue requested should have exited");
    }
 catch (    InterruptedException e) {
      log.warn("NotificationQueue got interrupted exception when stopping notifications",e);
    }
  }
  waitForNotificationStopCompletion();
}
