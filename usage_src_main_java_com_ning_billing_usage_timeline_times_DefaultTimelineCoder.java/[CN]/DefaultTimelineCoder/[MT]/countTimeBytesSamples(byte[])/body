{
  int count=0;
  try {
    final ByteArrayInputStream byteStream=new ByteArrayInputStream(timeBytes);
    final DataInputStream byteDataStream=new DataInputStream(byteStream);
    int opcode;
    while ((opcode=byteDataStream.read()) != -1) {
      if (opcode == TimelineOpcode.FULL_TIME.getOpcodeIndex()) {
        byteDataStream.readInt();
        count++;
      }
 else       if (opcode <= TimelineOpcode.MAX_DELTA_TIME) {
        count++;
      }
 else       if (opcode == TimelineOpcode.REPEATED_DELTA_TIME_BYTE.getOpcodeIndex()) {
        count+=byteDataStream.read();
        byteDataStream.read();
      }
 else       if (opcode == TimelineOpcode.REPEATED_DELTA_TIME_SHORT.getOpcodeIndex()) {
        count+=byteDataStream.readUnsignedShort();
        byteDataStream.read();
      }
 else {
        throw new IllegalStateException(String.format("In TimelineCoder.countTimeBytesSamples(), unrecognized opcode %d",opcode));
      }
    }
    return count;
  }
 catch (  IOException e) {
    log.error("IOException while counting timeline samples",e);
    return count;
  }
}
