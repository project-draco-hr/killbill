{
  checkNotNullParameter(account,"account");
  checkNotNullParameter(paymentMethodId,"paymentMethodId");
  if (paymentId == null) {
    checkNotNullParameter(amount,"amount");
    checkPositiveAmount(amount);
    checkNotNullParameter(currency,"currency");
  }
  checkNotNullParameter(properties,"plugin properties");
  final String transactionType=TransactionType.CREDIT.name();
  logAPICall(transactionType,account,paymentMethodId,paymentId,null,amount,currency,paymentExternalKey,paymentTransactionExternalKey,null,null);
  final InternalCallContext internalCallContext=internalCallContextFactory.createInternalCallContext(account.getId(),callContext);
  final Payment payment=paymentProcessor.createCredit(IS_API_PAYMENT,NULL_ATTEMPT_ID,account,paymentMethodId,paymentId,amount,currency,paymentExternalKey,paymentTransactionExternalKey,SHOULD_LOCK_ACCOUNT,properties,callContext,internalCallContext);
  final PaymentTransaction paymentTransaction=payment.getTransactions().get(payment.getTransactions().size() - 1);
  logAPICall(transactionType,account,payment.getPaymentMethodId(),payment.getId(),paymentTransaction.getId(),paymentTransaction.getProcessedAmount(),paymentTransaction.getProcessedCurrency(),payment.getExternalKey(),paymentTransaction.getExternalKey(),paymentTransaction.getTransactionStatus(),null);
  return payment;
}
