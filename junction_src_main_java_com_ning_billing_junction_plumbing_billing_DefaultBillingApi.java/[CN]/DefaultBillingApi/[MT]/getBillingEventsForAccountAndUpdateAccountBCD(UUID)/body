{
  final CallContext context=factory.createCallContext(API_USER_NAME,CallOrigin.INTERNAL,UserType.SYSTEM);
  final List<SubscriptionBundle> bundles=entitlementUserApi.getBundlesForAccount(accountId);
  final DefaultBillingEventSet result=new DefaultBillingEventSet();
  try {
    final Account account=accountApi.getAccountById(accountId);
    final Map<String,Tag> accountTags=tagApi.getTags(accountId,ObjectType.ACCOUNT);
    for (    Tag cur : accountTags.values()) {
      if (ControlTagType.AUTO_INVOICING_OFF.getId().equals(cur.getTagDefinitionId())) {
        result.setAccountAutoInvoiceIsOff(true);
        return result;
      }
    }
    addBillingEventsForBundles(bundles,account,context,result);
  }
 catch (  AccountApiException e) {
    log.warn("Failed while getting BillingEvent",e);
  }
  debugLog(result,"********* Billing Events Raw");
  blockCalculator.insertBlockingEvents(result);
  debugLog(result,"*********  Billing Events After Blocking");
  return result;
}
