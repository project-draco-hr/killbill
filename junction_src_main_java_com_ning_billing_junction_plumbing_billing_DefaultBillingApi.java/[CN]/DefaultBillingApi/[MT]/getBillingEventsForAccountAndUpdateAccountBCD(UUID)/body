{
  CallContext context=factory.createCallContext(API_USER_NAME,CallOrigin.INTERNAL,UserType.SYSTEM);
  List<SubscriptionBundle> bundles=entitlementUserApi.getBundlesForAccount(accountId);
  DefaultBillingEventSet result=new DefaultBillingEventSet();
  try {
    Account account=accountApi.getAccountById(accountId);
    Map<String,Tag> accountTags=tagApi.getTags(accountId,ObjectType.ACCOUNT);
    if (accountTags.get(ControlTagType.AUTO_INVOICING_OFF.name()) != null) {
      result.setAccountAutoInvoiceIsOff(true);
      return result;
    }
    addBillingEventsForBundles(bundles,account,context,result);
  }
 catch (  AccountApiException e) {
    log.warn("Failed while getting BillingEvent",e);
  }
  debugLog(result,"********* Billing Events Raw");
  blockCalculator.insertBlockingEvents(result);
  debugLog(result,"*********  Billing Events After Blocking");
  return result;
}
