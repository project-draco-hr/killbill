{
  for (  final Subscription subscription : subscriptions) {
    for (    final EffectiveSubscriptionEvent transition : subscription.getBillingTransitions()) {
      try {
        final BillCycleDay bcd=bcdCalculator.calculateBcd(bundle,subscription,transition,account);
        if (account.getBillCycleDay().getDayOfMonthUTC() == 0) {
          final MutableAccountData modifiedData=account.toMutableAccountData();
          modifiedData.setBillCycleDay(bcd);
          accountApi.updateAccount(account.getExternalKey(),modifiedData,context);
        }
        final BillingEvent event=new DefaultBillingEvent(account,transition,subscription,bcd.getDayOfMonthUTC(),account.getCurrency(),catalogService.getFullCatalog());
        result.add(event);
      }
 catch (      CatalogApiException e) {
        log.error("Failing to identify catalog components while creating BillingEvent from transition: " + transition.getId().toString(),e);
      }
catch (      Exception e) {
        log.warn("Failed while getting BillingEvent",e);
      }
    }
  }
}
