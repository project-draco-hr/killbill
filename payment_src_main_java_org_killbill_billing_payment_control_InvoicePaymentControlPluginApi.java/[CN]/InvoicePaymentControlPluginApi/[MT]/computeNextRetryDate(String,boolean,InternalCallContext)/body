{
  if (isApiAPayment) {
    return null;
  }
  final List<PaymentTransactionModelDao> purchasedTransactions=getPurchasedTransactions(paymentExternalKey,internalContext);
  if (purchasedTransactions.size() == 0) {
    return null;
  }
  final PaymentTransactionModelDao lastTransaction=purchasedTransactions.get(purchasedTransactions.size() - 1);
switch (lastTransaction.getPaymentStatus()) {
case PAYMENT_FAILURE_ABORTED:
    return getNextRetryDateForPaymentFailure(purchasedTransactions);
case UNKNOWN:
case PLUGIN_FAILURE_ABORTED:
  return getNextRetryDateForPluginFailure(purchasedTransactions);
default :
return null;
}
}
