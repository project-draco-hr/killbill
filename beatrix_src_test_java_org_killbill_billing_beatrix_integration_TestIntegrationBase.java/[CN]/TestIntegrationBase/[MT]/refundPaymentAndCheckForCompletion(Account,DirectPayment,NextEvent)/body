{
  return doCallAndCheckForCompletion(new Function<Void,DirectPayment>(){
    @Override public DirectPayment apply(    @Nullable final Void input){
      try {
        return paymentApi.createRefundWithPaymentControl(account,payment.getId(),payment.getPurchasedAmount(),payment.getCurrency(),UUID.randomUUID().toString(),PLUGIN_PROPERTIES,PAYMENT_OPTIONS,callContext);
      }
 catch (      final PaymentApiException e) {
        fail(e.toString());
        return null;
      }
    }
  }
,events);
}
