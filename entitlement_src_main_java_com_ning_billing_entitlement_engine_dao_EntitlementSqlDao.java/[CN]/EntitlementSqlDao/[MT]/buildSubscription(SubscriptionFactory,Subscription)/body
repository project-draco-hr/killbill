{
  if (input == null) {
    return null;
  }
  List<Subscription> bundleInput=new ArrayList<Subscription>();
  if (input.getCategory() == ProductCategory.ADD_ON) {
    Subscription baseSubscription=getBaseSubscription(factory,input.getBundleId(),false);
    bundleInput.add(baseSubscription);
    bundleInput.add(input);
  }
 else {
    bundleInput.add(input);
  }
  List<Subscription> reloadedSubscriptions=buildBundleSubscriptions(factory,bundleInput);
  for (  Subscription cur : reloadedSubscriptions) {
    if (cur.getId().equals(input.getId())) {
      return cur;
    }
  }
  throw new EntitlementError(String.format("Unexpected code path in buildSubscription"));
}
