{
  List<PaymentMethod> methods=paymentApi.getPaymentMethods(account,false);
  assertEquals(methods.size(),1);
  final PaymentMethod initDefaultMethod=methods.get(0);
  assertEquals(initDefaultMethod.getId(),account.getPaymentMethodId());
  final PaymentMethodPlugin newPaymenrMethod=new DefaultNoOpPaymentMethodPlugin(UUID.randomUUID().toString(),true,null);
  final UUID newPaymentMethodId=paymentApi.addPaymentMethod(PaymentTestModuleWithMocks.PLUGIN_TEST_NAME,account,true,newPaymenrMethod,context);
  ((ZombieControl)account).addResult("getPaymentMethodId",newPaymentMethodId);
  methods=paymentApi.getPaymentMethods(account,false);
  assertEquals(methods.size(),2);
  assertEquals(newPaymentMethodId,account.getPaymentMethodId());
  boolean failed=false;
  try {
    paymentApi.deletedPaymentMethod(account,newPaymentMethodId,context);
  }
 catch (  PaymentApiException e) {
    failed=true;
  }
  assertTrue(failed);
  paymentApi.deletedPaymentMethod(account,initDefaultMethod.getId(),context);
  methods=paymentApi.getPaymentMethods(account,false);
  assertEquals(methods.size(),1);
}
