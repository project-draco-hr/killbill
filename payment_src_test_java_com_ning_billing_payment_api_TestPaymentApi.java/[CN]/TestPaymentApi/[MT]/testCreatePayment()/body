{
  final DateTime now=new DateTime();
  final Account account=testHelper.createTestAccount();
  final Invoice invoice=testHelper.createTestInvoice(account,now,Currency.USD);
  final BigDecimal amount=new BigDecimal("10.00");
  final UUID subscriptionId=UUID.randomUUID();
  invoice.addInvoiceItem(new RecurringInvoiceItem(invoice.getId(),subscriptionId,"test plan","test phase",now,now.plusMonths(1),amount,new BigDecimal("1.0"),Currency.USD));
  List<Either<PaymentError,PaymentInfo>> results=paymentApi.createPayment(account.getExternalKey(),Arrays.asList(invoice.getId().toString()));
  assertEquals(results.size(),1);
  assertTrue(results.get(0).isRight());
  PaymentInfo paymentInfo=results.get(0).getRight();
  assertNotNull(paymentInfo.getPaymentId());
  assertEquals(paymentInfo.getAmount().doubleValue(),amount.doubleValue());
}
