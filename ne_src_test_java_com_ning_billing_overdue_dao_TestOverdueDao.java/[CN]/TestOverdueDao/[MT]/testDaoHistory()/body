{
  ClockMock clock=new ClockMock();
  SubscriptionBundle bundle=BrainDeadProxyFactory.createBrainDeadProxyFor(SubscriptionBundle.class);
  UUID bundleId=UUID.randomUUID();
  ((ZombieControl)bundle).addResult("getId",bundleId);
  String overdueStateName="WayPassedItMan";
  @SuppressWarnings("unchecked") OverdueState<SubscriptionBundle> state=BrainDeadProxyFactory.createBrainDeadProxyFor(OverdueState.class);
  ((ZombieControl)state).addResult("getName",overdueStateName);
  dao.setOverdueState(bundle,state,Overdueable.Type.SUBSCRIPTION_BUNDLE,clock);
  clock.setDeltaFromReality(1000 * 3600 * 24);
  String overdueStateName2="NoReallyThisCantGoOn";
  ((ZombieControl)state).addResult("getName",overdueStateName2);
  dao.setOverdueState(bundle,state,Overdueable.Type.SUBSCRIPTION_BUNDLE,clock);
  SortedSet<OverdueEvent> history1=accessDao.getOverdueHistoryFor(bundle);
  SortedSet<OverdueEvent> history2=accessDao.getOverdueHistoryForIdAndType(bundle.getId(),Overdueable.Type.get(bundle));
  Assert.assertEquals(history1.size(),2);
  Assert.assertEquals(history1.first().getStateName(),overdueStateName);
  Assert.assertEquals(history1.last().getStateName(),overdueStateName2);
  Assert.assertEquals(history2.size(),2);
  Assert.assertEquals(history2.first().getStateName(),overdueStateName);
  Assert.assertEquals(history2.last().getStateName(),overdueStateName2);
}
