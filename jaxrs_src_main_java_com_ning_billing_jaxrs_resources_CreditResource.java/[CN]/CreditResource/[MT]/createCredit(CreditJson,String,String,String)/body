{
  final Account account=accountUserApi.getAccountById(UUID.fromString(json.getAccountId()));
  final LocalDate effectiveDate=json.getEffectiveDate().toDateTime(account.getTimeZone()).toLocalDate();
  final InvoiceItem credit;
  if (json.getInvoiceId() != null) {
    credit=invoiceUserApi.insertCreditForInvoice(account.getId(),UUID.fromString(json.getInvoiceId()),json.getCreditAmount(),effectiveDate,account.getCurrency(),context.createContext(createdBy,reason,comment));
  }
 else {
    credit=invoiceUserApi.insertCredit(account.getId(),json.getCreditAmount(),effectiveDate,account.getCurrency(),context.createContext(createdBy,reason,comment));
  }
  return uriBuilder.buildResponse(CreditResource.class,"getCredit",credit.getId());
}
