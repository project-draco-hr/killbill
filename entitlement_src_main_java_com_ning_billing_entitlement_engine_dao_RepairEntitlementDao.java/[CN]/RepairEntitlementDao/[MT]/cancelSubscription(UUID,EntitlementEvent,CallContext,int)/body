{
  final long activeVersion=cancelEvent.getActiveVersion();
  addEvents(subscriptionId,Collections.singletonList(cancelEvent));
  final SubscriptionRepairEvent target=getRepairSubscriptionEvents(subscriptionId);
  boolean foundCancelEvent=false;
  for (  final EntitlementEvent cur : target.getEvents()) {
    if (cur.getId().equals(cancelEvent.getId())) {
      foundCancelEvent=true;
    }
 else     if (foundCancelEvent) {
      cur.setActiveVersion(activeVersion - 1);
    }
  }
}
