{
  dbi.inTransaction(new TransactionCallback<Void>(){
    @Override public Void inTransaction(    Handle conn,    TransactionStatus status) throws Exception {
      InvoiceDao invoiceDao=conn.attach(InvoiceDao.class);
      Invoice currentInvoice=invoiceDao.getById(invoice.getId().toString());
      invoiceDao.save(invoice);
      if (currentInvoice == null) {
        InvoiceCreationNotification event;
        event=new DefaultInvoiceCreationNotification(invoice.getId(),invoice.getAccountId(),invoice.getAmountOutstanding(),invoice.getCurrency(),invoice.getInvoiceDate());
        eventBus.post(event);
      }
 else {
      }
      return null;
    }
  }
);
}
