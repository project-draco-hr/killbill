{
  final Subscription subscription=testUtil.createSubscription(bundle,"Shotgun",BillingPeriod.ANNUAL,PriceListSet.DEFAULT_PRICELIST_NAME);
  try {
    subscription.changePlanWithPolicy("Shotgun",BillingPeriod.MONTHLY,PriceListSet.DEFAULT_PRICELIST_NAME,clock.getUTCNow(),ActionPolicy.ILLEGAL,callContext);
    Assert.fail();
  }
 catch (  SubscriptionError error) {
    assertTrue(true);
    assertEquals(subscriptionApi.getSubscriptionFromId(subscription.getId(),tenantContext).getCurrentPlan().getBillingPeriod(),BillingPeriod.ANNUAL);
  }
  assertTrue(subscription.changePlanWithPolicy("Shotgun",BillingPeriod.MONTHLY,PriceListSet.DEFAULT_PRICELIST_NAME,clock.getUTCNow(),ActionPolicy.IMMEDIATE,callContext));
  assertEquals(subscriptionApi.getSubscriptionFromId(subscription.getId(),tenantContext).getCurrentPlan().getBillingPeriod(),BillingPeriod.MONTHLY);
}
