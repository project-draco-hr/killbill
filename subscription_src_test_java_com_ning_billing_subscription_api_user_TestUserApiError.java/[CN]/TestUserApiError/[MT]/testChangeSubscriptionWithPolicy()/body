{
  final SubscriptionBase subscription=testUtil.createSubscription(bundle,"Shotgun",BillingPeriod.ANNUAL,PriceListSet.DEFAULT_PRICELIST_NAME);
  try {
    subscription.changePlanWithPolicy("Shotgun",BillingPeriod.MONTHLY,PriceListSet.DEFAULT_PRICELIST_NAME,BillingActionPolicy.ILLEGAL,callContext);
    Assert.fail();
  }
 catch (  SubscriptionBaseError error) {
    assertTrue(true);
    assertEquals(subscriptionInternalApi.getSubscriptionFromId(subscription.getId(),internalCallContext).getCurrentPlan().getBillingPeriod(),BillingPeriod.ANNUAL);
  }
  assertTrue(subscription.changePlanWithPolicy("Shotgun",BillingPeriod.MONTHLY,PriceListSet.DEFAULT_PRICELIST_NAME,BillingActionPolicy.IMMEDIATE,callContext));
  assertEquals(subscriptionInternalApi.getSubscriptionFromId(subscription.getId(),internalCallContext).getCurrentPlan().getBillingPeriod(),BillingPeriod.MONTHLY);
}
