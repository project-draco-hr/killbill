{
  shuttingDown.set(true);
  final boolean doingFastShutdown=shutdownSaveMode == ShutdownSaveMode.SAVE_START_TIMES;
  if (doingFastShutdown) {
    final StartTimes startTimes=new StartTimes();
    saveStartTimes(startTimes);
    timelineDAO.insertLastStartTimes(startTimes,context);
    log.info("During shutdown, saved timeline start times in the db");
  }
 else {
    saveAccumulators();
    log.info("During shutdown, saved timeline accumulators");
  }
  performShutdown();
  backingBuffer.discard();
}
