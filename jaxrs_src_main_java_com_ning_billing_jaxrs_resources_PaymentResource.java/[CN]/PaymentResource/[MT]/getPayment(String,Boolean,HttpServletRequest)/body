{
  final TenantContext tenantContext=context.createContext(request);
  final UUID paymentId=UUID.fromString(paymentIdString);
  final Payment payment=paymentApi.getPayment(paymentId,false,tenantContext);
  final PaymentJsonSimple paymentJsonSimple;
  if (withRefundsAndChargebacks) {
    final List<RefundJson> refunds=new ArrayList<RefundJson>();
    for (    final Refund refund : paymentApi.getPaymentRefunds(paymentId,tenantContext)) {
      refunds.add(new RefundJson(refund));
    }
    final List<ChargebackJson> chargebacks=new ArrayList<ChargebackJson>();
    for (    final InvoicePayment chargeback : invoicePaymentApi.getChargebacksByPaymentId(paymentId,tenantContext)) {
      chargebacks.add(new ChargebackJson(payment.getAccountId(),chargeback));
    }
    final int nbOfPaymentAttempts=payment.getAttempts().size();
    final String status=payment.getPaymentStatus().toString();
    paymentJsonSimple=new PaymentJsonWithBundleKeys(payment,status,nbOfPaymentAttempts,null,payment.getAccountId(),refunds,chargebacks);
  }
 else {
    paymentJsonSimple=new PaymentJsonSimple(payment);
  }
  return Response.status(Status.OK).entity(paymentJsonSimple).build();
}
