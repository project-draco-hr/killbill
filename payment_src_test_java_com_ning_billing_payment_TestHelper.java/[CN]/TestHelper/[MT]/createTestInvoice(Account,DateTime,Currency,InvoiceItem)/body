{
  Invoice invoice=new DefaultInvoice(UUID.randomUUID(),account.getId(),1,new DateTime(),targetDate,currency);
  for (  InvoiceItem item : items) {
    if (item instanceof RecurringInvoiceItem) {
      RecurringInvoiceItem recurringInvoiceItem=(RecurringInvoiceItem)item;
      invoice.addInvoiceItem(new RecurringInvoiceItem(invoice.getId(),recurringInvoiceItem.getSubscriptionId(),recurringInvoiceItem.getBundleId(),recurringInvoiceItem.getPlanName(),recurringInvoiceItem.getPhaseName(),recurringInvoiceItem.getStartDate(),recurringInvoiceItem.getEndDate(),recurringInvoiceItem.getAmount(),recurringInvoiceItem.getRate(),recurringInvoiceItem.getCurrency(),recurringInvoiceItem.getCreatedDate()));
    }
  }
  invoiceDao.create(invoice);
  return invoice;
}
