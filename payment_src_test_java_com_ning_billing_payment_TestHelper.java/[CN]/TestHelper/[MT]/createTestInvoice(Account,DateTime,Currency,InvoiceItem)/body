{
  Invoice invoice=new DefaultInvoice(account.getId(),new DateTime(),targetDate,currency);
  for (  InvoiceItem item : items) {
    if (item instanceof RecurringInvoiceItem) {
      RecurringInvoiceItem recurringInvoiceItem=(RecurringInvoiceItem)item;
      invoice.addInvoiceItem(new RecurringInvoiceItem(invoice.getId(),recurringInvoiceItem.getSubscriptionId(),recurringInvoiceItem.getPlanName(),recurringInvoiceItem.getPhaseName(),recurringInvoiceItem.getStartDate(),recurringInvoiceItem.getEndDate(),recurringInvoiceItem.getAmount(),recurringInvoiceItem.getRate(),recurringInvoiceItem.getCurrency()));
    }
  }
  invoiceDao.create(invoice,context);
  return invoice;
}
