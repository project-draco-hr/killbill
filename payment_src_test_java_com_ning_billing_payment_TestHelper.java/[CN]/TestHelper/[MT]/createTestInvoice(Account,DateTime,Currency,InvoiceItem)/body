{
  Invoice invoice=new MockInvoice(account.getId(),new DateTime(),targetDate,currency);
  for (  InvoiceItem item : items) {
    if (item instanceof MockRecurringInvoiceItem) {
      MockRecurringInvoiceItem recurringInvoiceItem=(MockRecurringInvoiceItem)item;
      invoice.addInvoiceItem(new MockRecurringInvoiceItem(invoice.getId(),account.getId(),recurringInvoiceItem.getBundleId(),recurringInvoiceItem.getSubscriptionId(),recurringInvoiceItem.getPlanName(),recurringInvoiceItem.getPhaseName(),recurringInvoiceItem.getStartDate(),recurringInvoiceItem.getEndDate(),recurringInvoiceItem.getAmount(),recurringInvoiceItem.getRate(),recurringInvoiceItem.getCurrency()));
    }
  }
  ((ZombieControl)invoicePaymentApi).addResult("getInvoice",invoice);
  InvoiceCreationEvent event=new MockInvoiceCreationEvent(invoice.getId(),invoice.getAccountId(),invoice.getBalance(),invoice.getCurrency(),invoice.getInvoiceDate(),context.getUserToken());
  eventBus.post(event);
  return invoice;
}
