{
  final PhaseType initialPhaseType;
  final List<EffectiveSubscriptionInternalEvent> transitions=entitlementApi.getAllTransitions(subscription,context);
  if (transitions.size() == 0) {
    initialPhaseType=null;
  }
 else {
    final DateTime requestedDate=subscription.getStartDate();
    final String initialPhaseString=transitions.get(0).getNextPhase();
    if (initialPhaseString == null) {
      initialPhaseType=null;
    }
 else {
      final PlanPhase initialPhase=catalog.findPhase(initialPhaseString,requestedDate,subscription.getStartDate());
      if (initialPhase == null) {
        initialPhaseType=null;
      }
 else {
        initialPhaseType=initialPhase.getPhaseType();
      }
    }
  }
  final DateTime date=plan.dateOfFirstRecurringNonZeroCharge(subscription.getStartDate(),initialPhaseType);
  final CalculatedBillCycleDay calculatedBillCycleDay=new CalculatedBillCycleDay(account.getTimeZone(),date);
  log.info("Calculated BCD: subscription id {}, subscription start {}, timezone {}, bcd UTC {}, bcd local {}",new Object[]{subscription.getId(),date.toDateTimeISO(),account.getTimeZone(),calculatedBillCycleDay.getDayOfMonthUTC(),calculatedBillCycleDay.getDayOfMonthLocal()});
  return calculatedBillCycleDay;
}
