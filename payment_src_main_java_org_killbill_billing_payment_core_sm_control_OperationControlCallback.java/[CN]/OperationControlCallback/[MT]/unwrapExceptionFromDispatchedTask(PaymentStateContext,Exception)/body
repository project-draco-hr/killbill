{
  final Throwable originalExceptionOrCause=e instanceof ExecutionException ? MoreObjects.firstNonNull(e.getCause(),e) : e;
  if (originalExceptionOrCause instanceof OperationException) {
    return (OperationException)originalExceptionOrCause;
  }
 else   if (originalExceptionOrCause instanceof LockFailedException) {
    final String format=String.format("Failed to lock account %s",paymentStateContext.getAccount().getExternalKey());
    logger.error(String.format(format));
  }
 else   if (originalExceptionOrCause instanceof TimeoutException) {
    logger.warn("RetryOperationCallback call TIMEOUT for account {}",paymentStateContext.getAccount().getExternalKey());
  }
 else   if (originalExceptionOrCause instanceof InterruptedException) {
    logger.error("RetryOperationCallback call was interrupted for account {}",paymentStateContext.getAccount().getExternalKey());
  }
 else {
    logger.warn("RetryOperationCallback failed for account {}",paymentStateContext.getAccount().getExternalKey(),e);
  }
  return new OperationException(e,getOperationResultOnException(paymentStateContext));
}
