{
  final CategoryRecordIdAndMetric categoryRecordIdAndMetric=new CategoryRecordIdAndMetric(eventCategoryId,metric);
  Integer metricId=metricsCache.inverse().get(categoryRecordIdAndMetric);
  if (metricId == null) {
    metricId=delegate.getOrAddMetric(eventCategoryId,metric,context);
synchronized (metricsCache) {
      if (metricsCache.get(metricId) == null) {
        metricsCache.put(metricId,categoryRecordIdAndMetric);
      }
    }
  }
  return metricId;
}
