{
  if (paymentStateContext.getPaymentTransactionExternalKey() == null) {
    return;
  }
  if (Iterables.any(existingPaymentTransactions,new Predicate<PaymentTransactionModelDao>(){
    @Override public boolean apply(    final PaymentTransactionModelDao input){
      return (paymentStateContext.getPaymentId() != null && input.getPaymentId().compareTo(paymentStateContext.getPaymentId()) != 0) || (!input.getAccountRecordId().equals(paymentStateContext.getInternalCallContext().getAccountRecordId()));
    }
  }
)) {
    throw new PaymentApiException(ErrorCode.PAYMENT_ACTIVE_TRANSACTION_KEY_EXISTS,paymentStateContext.getPaymentTransactionExternalKey());
  }
}
