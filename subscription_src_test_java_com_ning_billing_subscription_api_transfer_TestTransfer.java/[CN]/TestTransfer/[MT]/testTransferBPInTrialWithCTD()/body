{
  final UUID newAccountId=UUID.randomUUID();
  final String baseProduct="Shotgun";
  final BillingPeriod baseTerm=BillingPeriod.MONTHLY;
  final String basePriceList=PriceListSet.DEFAULT_PRICELIST_NAME;
  final SubscriptionBase baseSubscription=testUtil.createSubscription(bundle,baseProduct,baseTerm,basePriceList);
  final DateTime ctd=baseSubscription.getStartDate().plusDays(30);
  subscriptionInternalApi.setChargedThroughDate(baseSubscription.getId(),ctd,internalCallContext);
  final DateTime evergreenPhaseDate=((DefaultSubscriptionBase)baseSubscription).getPendingTransition().getEffectiveTransitionTime();
  clock.addDays(20);
  testListener.pushExpectedEvent(NextEvent.TRANSFER);
  final DateTime transferRequestedDate=clock.getUTCNow();
  transferApi.transferBundle(bundle.getAccountId(),newAccountId,bundle.getExternalKey(),transferRequestedDate,false,false,callContext);
  assertTrue(testListener.isCompleted(3000));
  final SubscriptionBase oldBaseSubscription=subscriptionInternalApi.getSubscriptionFromId(baseSubscription.getId(),internalCallContext);
  assertNotNull(oldBaseSubscription.getFutureEndDate());
  assertTrue(oldBaseSubscription.getFutureEndDate().compareTo(ctd) == 0);
  final SubscriptionBaseBundle newBundle=subscriptionInternalApi.getBundleForAccountAndKey(newAccountId,bundle.getExternalKey(),internalCallContext);
  final List<SubscriptionBase> subscriptions=subscriptionInternalApi.getSubscriptionsForBundle(newBundle.getId(),internalCallContext);
  assertEquals(subscriptions.size(),1);
  final SubscriptionBase newBaseSubscription=subscriptions.get(0);
  assertTrue(((DefaultSubscriptionBase)newBaseSubscription).getAlignStartDate().compareTo(((DefaultSubscriptionBase)oldBaseSubscription).getAlignStartDate()) == 0);
  assertEquals(subscriptionInternalApi.getAllTransitions(newBaseSubscription,internalCallContext).size(),2);
  assertTrue(subscriptionInternalApi.getAllTransitions(newBaseSubscription,internalCallContext).get(1).getEffectiveTransitionTime().compareTo(evergreenPhaseDate) == 0);
  final Plan newPlan=newBaseSubscription.getCurrentPlan();
  assertEquals(newPlan.getProduct().getName(),baseProduct);
  assertEquals(newBaseSubscription.getCurrentPhase().getPhaseType(),PhaseType.TRIAL);
}
