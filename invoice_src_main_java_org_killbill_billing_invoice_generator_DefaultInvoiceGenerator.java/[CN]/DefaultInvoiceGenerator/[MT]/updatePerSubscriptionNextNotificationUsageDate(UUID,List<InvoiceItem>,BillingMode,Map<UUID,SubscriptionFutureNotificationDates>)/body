{
  for (  final InvoiceItem item : newInArrearUsageItems) {
    SubscriptionFutureNotificationDates subscriptionFutureNotificationDates=perSubscriptionFutureNotificationDates.get(subscriptionId);
    if (subscriptionFutureNotificationDates == null) {
      subscriptionFutureNotificationDates=new SubscriptionFutureNotificationDates(null);
      perSubscriptionFutureNotificationDates.put(subscriptionId,subscriptionFutureNotificationDates);
    }
    subscriptionFutureNotificationDates.updateNextUsageDateIfRequired(item.getUsageName(),usageBillingMode,item.getEndDate());
  }
}
