{
  if (state != EntitlementState.ACTIVE) {
    throw new EntitlementApiException(ErrorCode.SUB_CHANGE_NON_ACTIVE,getId(),state);
  }
  final InternalCallContext context=internalCallContextFactory.createInternalCallContext(accountId,callContext);
  final DateTime requestedDate=dateHelper.fromLocalDateAndReferenceTime(localDate,subscriptionBase.getStartDate(),context);
  try {
    checker.checkBlockedChange(subscriptionBase,context);
    subscriptionBase.changePlan(productName,billingPeriod,priceList,requestedDate,callContext);
    return entitlementApi.getEntitlementForId(getId(),callContext);
  }
 catch (  BlockingApiException e) {
    throw new EntitlementApiException(e,e.getCode(),e.getMessage());
  }
catch (  SubscriptionBaseApiException e) {
    throw new EntitlementApiException(e);
  }
}
