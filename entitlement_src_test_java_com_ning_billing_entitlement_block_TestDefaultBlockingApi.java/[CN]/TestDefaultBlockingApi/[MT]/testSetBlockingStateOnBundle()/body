{
  final UUID bundleId=UUID.randomUUID();
  getDBI().withHandle(new HandleCallback<Void>(){
    @Override public Void withHandle(    final Handle handle) throws Exception {
      handle.execute("DROP TABLE IF EXISTS bundles;\n" + "CREATE TABLE bundles (\n" + "    record_id int(11) unsigned NOT NULL AUTO_INCREMENT,\n"+ "    id char(36) NOT NULL,\n"+ "    external_key varchar(64) NOT NULL,\n"+ "    account_id char(36) NOT NULL,\n"+ "    last_sys_update_date datetime,\n"+ "    account_record_id int(11) unsigned default null,\n"+ "    tenant_record_id int(11) unsigned default null,\n"+ "    PRIMARY KEY(record_id)\n"+ ") ENGINE=innodb;");
      handle.execute("insert into bundles (id, external_key, account_id, account_record_id) values (?, 'foo', ?, ?)",bundleId.toString(),UUID.randomUUID().toString(),internalCallContext.getAccountRecordId());
      return null;
    }
  }
);
  final BlockingState blockingState=new DefaultBlockingState(UUID.randomUUID(),bundleId,"BLOCKED","myService",true,true,true,internalCallContext.getCreatedDate(),null);
  blockingInternalApi.setBlockingState(blockingState,internalCallContext);
  final BlockingState resultState=blockingInternalApi.getBlockingStateFor(bundleId,internalCallContext);
  Assert.assertEquals(resultState.getStateName(),blockingState.getStateName());
  getDBI().withHandle(new HandleCallback<Void>(){
    @Override public Void withHandle(    final Handle handle) throws Exception {
      final List<Map<String,Object>> values=handle.select("select account_record_id from blocking_states where blockable_id = ?",bundleId.toString());
      Assert.assertEquals(values.size(),1);
      Assert.assertEquals(values.get(0).keySet().size(),1);
      Assert.assertEquals(values.get(0).get("account_record_id"),internalCallContext.getAccountRecordId());
      return null;
    }
  }
);
}
