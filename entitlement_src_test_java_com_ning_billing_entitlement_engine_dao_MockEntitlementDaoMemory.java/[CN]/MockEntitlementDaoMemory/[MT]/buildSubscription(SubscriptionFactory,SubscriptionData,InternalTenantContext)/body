{
  if (factory != null) {
    return factory.createSubscription(new SubscriptionBuilder(in),getEventsForSubscription(in.getId(),context));
  }
 else {
    final SubscriptionData subscription=new SubscriptionData(new SubscriptionBuilder(in),null,clock);
    if (events.size() > 0) {
      subscription.rebuildTransitions(getEventsForSubscription(in.getId(),context),catalogService.getFullCatalog());
    }
    return subscription;
  }
}
