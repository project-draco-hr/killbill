{
  PlanSpecifier planSpecifier=new PlanSpecifier(plan.getProduct().getName(),plan.getProduct().getCategory(),plan.getBillingPeriod(),priceList);
  DateTime planStartDate=null;
  PlanAlignmentCreate alignement=catalog.getPlanCreateAlignment(planSpecifier);
switch (alignement) {
case START_OF_SUBSCRIPTION:
    planStartDate=subscription.getStartDate();
  break;
case START_OF_BUNDLE:
planStartDate=subscription.getBundleStartDate();
break;
default :
throw new EntitlementError(String.format("Unknwon PlanAlignmentCreate %s",alignement));
}
List<TimedPhase> timedPhases=getPhaseAlignments(subscription,plan,effectiveDate,planStartDate);
return getTimedPhase(timedPhases,effectiveDate,which);
}
