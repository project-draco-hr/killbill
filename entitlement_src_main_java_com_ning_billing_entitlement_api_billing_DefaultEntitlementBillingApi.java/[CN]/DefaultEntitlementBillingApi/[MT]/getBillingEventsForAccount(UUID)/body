{
  List<SubscriptionBundle> bundles=dao.getSubscriptionBundleForAccount(accountId);
  List<Subscription> subscriptions=new ArrayList<Subscription>();
  for (  SubscriptionBundle bundle : bundles) {
    subscriptions.addAll(dao.getSubscriptions(bundle.getId()));
  }
  SortedSet<BillingEvent> result=new TreeSet<BillingEvent>();
  for (  Subscription subscription : subscriptions) {
    for (    SubscriptionTransition transition : subscription.getAllTransitions()) {
      try {
        result.add(new DefaultBillingEvent(transition,subscription,calculateBCD(transition,accountId)));
      }
 catch (      CatalogApiException e) {
        log.error("Failing to identify catalog components while creating BillingEvent from transition: " + transition.getId().toString(),e);
      }
    }
  }
  return result;
}
